# dart:js_interop -- JavaScript互操作库

Dart 3.x 推荐的 JS 互操作方案，提供完善的类型层次结构和辅助函数，用于与 JavaScript 和浏览器 API 互操作，替代旧的 `dart:html` 和 `package:js`。

### 1.1 核心能力

- JS 类型系统（JSObject、JSFunction、JSPromise、JSArray、JSString、JSNumber、JSBoolean、JSAny）
- 静态互操作注解（@JS、@staticInterop、@anonymous）
- 导入与导出（createJSInteropWrapper、jsify、toDart）
- 外部函数声明（external、inline）
- 异常处理（JSException）

### 1.2 库结构

```dart
dart:js_interop
│
├── JS 类型层次
│   ├── JSAny                     # 任意 JS 值基类 (dart:js_interop 根类型)
│   ├── JSObject                  # JS 对象基类 (Object/函数/数组等)
│   ├── JSFunction                # JS 函数类型
│   ├── JSPromise                 # JS Promise (异步操作)
│   ├── JSArray                   # JS 数组
│   ├── JSArrayBuffer             # JS ArrayBuffer (二进制数据缓冲区)
│   ├── JSDataView                # JS DataView (多视图数据访问)
│   ├── JSTypedArray              # 类型化数组基类
│   ├── JSInt8Array               # 8 位有符号整数数组
│   ├── JSUint8Array              # 8 位无符号整数数组
│   ├── JSUint8ClampedArray       # 8 位无符号钳制数组 (Canvas)
│   ├── JSInt16Array              # 16 位有符号整数数组
│   ├── JSUint16Array             # 16 位无符号整数数组
│   ├── JSInt32Array              # 32 位有符号整数数组
│   ├── JSUint32Array             # 32 位无符号整数数组
│   ├── JSFloat32Array            # 32 位浮点数数组
│   ├── JSFloat64Array            # 64 位浮点数数组
│   ├── JSBigInt64Array           # 64 位有符号 BigInt 数组
│   ├── JSBigUint64Array          # 64 位无符号 BigInt 数组
│   ├── JSString                  # JS 字符串
│   ├── JSNumber                  # JS 数字 (浮点/整数)
│   ├── JSBoolean                 # JS 布尔值
│   ├── JSBigInt                  # JS BigInt (任意精度整数)
│   └── JSSymbol                  # JS Symbol (唯一标识符)
│
├── 互操作注解
│   ├── @JS                       # 标记类/函数/变量绑定到 JS
│   ├── @staticInterop            # 静态互操作 (无运行时检查，性能更高)
│   ├── @anonymous                # 标记匿名 JS 对象 (无原型链)
│   ├── @JSExport                 # 导出 Dart 类/方法到 JS
│   └── @JSName                   # 指定 JS 端名称 (重命名)
│
├── 转换函数
│   ├── jsify()                   # Dart 集合/Map 转为 JS 对象/数组
│   ├── toDart()                  # JS 值转为 Dart 值
│   ├── toJS()                    # Dart 基础类型转为 JS 类型
│   ├── createJSInteropWrapper()  # 为 Dart 对象创建 JS 包装器
│   └── dartify()                 # 深层转换 JS 对象为 Dart Map/List
│
├── 运行时工具
│   ├── globalThis                # JS 全局 this 对象 (window/global)
│   ├── hasProperty()             # 检查对象属性是否存在
│   ├── getProperty()             # 获取对象属性值
│   ├── setProperty()             # 设置对象属性值
│   ├── callMethod()              # 调用对象方法
│   ├── instanceof()              # 检查原型链 (instanceof 操作符)
│   ├── typeof()                  # 获取类型字符串 (typeof 操作符)
│   ├── isUndefined()             # 检查是否为 undefined
│   ├── isNull()                  # 检查是否为 null
│   ├── strictEquals()            # JS 严格相等 (===)
│   ├── looseEquals()             # JS 宽松相等 (==)
│   └── JSException               # JS 异常封装
│
└── 导出工具
    ├── exportToJS()              # 将 Dart 函数导出到 JS
    └── createDartExport()        # 创建 Dart 导出对象
```



---

