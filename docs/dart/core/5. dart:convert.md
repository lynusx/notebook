# dart:convert -- ç¼–è§£ç åº“

æä¾›ä¸åŒæ•°æ®è¡¨ç¤ºæ ¼å¼ä¹‹é—´çš„è½¬æ¢èƒ½åŠ›ï¼ˆç¼–ç å™¨å’Œè§£ç å™¨ï¼‰ï¼Œç‰¹åˆ«æ˜¯ JSON å’Œ UTF-8ã€‚

### 1.1 æ ¸å¿ƒèƒ½åŠ›

- JSON ç¼–è§£ç ï¼ˆJsonCodecã€JsonEncoderã€JsonDecoderï¼‰
- UTF-8 ç¼–è§£ç ï¼ˆUtf8Codecã€Utf8Encoderã€Utf8Decoderï¼‰
- Base64 ç¼–è§£ç ï¼ˆBase64Codecï¼‰
- ASCII ç¼–è§£ç ï¼ˆAsciiCodecï¼‰
- Latin1 (ISO-8859-1) ç¼–è§£ç ï¼ˆLatin1Codecï¼‰
- è¡Œåˆ†å‰²è½¬æ¢ï¼ˆLineSplitterï¼‰
- è‡ªå®šä¹‰è½¬æ¢å™¨æ¡†æ¶ï¼ˆConverterã€ChunkedConversionSinkï¼‰

### 1.2 åº“ç»“æ„

```dart
dart:convert
â”‚
â”œâ”€â”€ JSON å¤„ç†
â”‚   â”œâ”€â”€ json                      # å…¨å±€ JsonCodec å®ä¾‹ (å¸¸é‡)
â”‚   â”œâ”€â”€ JsonCodec                 # JSON ç¼–è§£ç å™¨ç±»
â”‚   â”œâ”€â”€ JsonEncoder               # JSON ç¼–ç å™¨ (å¯¹è±¡ â†’ å­—ç¬¦ä¸²)
â”‚   â”œâ”€â”€ JsonDecoder               # JSON è§£ç å™¨ (å­—ç¬¦ä¸² â†’ å¯¹è±¡)
â”‚   â”œâ”€â”€ jsonEncode()              # é¡¶å±‚ä¾¿æ·ç¼–ç å‡½æ•°
â”‚   â””â”€â”€ jsonDecode()              # é¡¶å±‚ä¾¿æ·è§£ç å‡½æ•°
â”‚
â”œâ”€â”€ UTF-8 å¤„ç†
â”‚   â”œâ”€â”€ utf8                      # å…¨å±€ Utf8Codec å®ä¾‹ (å¸¸é‡)
â”‚   â”œâ”€â”€ Utf8Codec                 # UTF-8 ç¼–è§£ç å™¨ç±»
â”‚   â”œâ”€â”€ Utf8Encoder               # UTF-8 ç¼–ç å™¨ (å­—ç¬¦ä¸² â†’ å­—èŠ‚)
â”‚   â””â”€â”€ Utf8Decoder               # UTF-8 è§£ç å™¨ (å­—èŠ‚ â†’ å­—ç¬¦ä¸²)
â”‚
â”œâ”€â”€ ASCII å¤„ç†
â”‚   â”œâ”€â”€ ascii                     # å…¨å±€ AsciiCodec å®ä¾‹ (å¸¸é‡)
â”‚   â”œâ”€â”€ AsciiCodec                # ASCII ç¼–è§£ç å™¨ç±» (0-127)
â”‚   â”œâ”€â”€ AsciiEncoder              # ASCII ç¼–ç å™¨
â”‚   â””â”€â”€ AsciiDecoder              # ASCII è§£ç å™¨
â”‚
â”œâ”€â”€ Latin1 (ISO-8859-1) å¤„ç†
â”‚   â”œâ”€â”€ latin1                    # å…¨å±€ Latin1Codec å®ä¾‹ (å¸¸é‡)
â”‚   â”œâ”€â”€ Latin1Codec               # Latin1 ç¼–è§£ç å™¨ç±» (å•å­—èŠ‚æ‰©å±• ASCII)
â”‚   â”œâ”€â”€ Latin1Encoder             # Latin1 ç¼–ç å™¨
â”‚   â””â”€â”€ Latin1Decoder             # Latin1 è§£ç å™¨
â”‚
â”œâ”€â”€ Base64 å¤„ç†
â”‚   â”œâ”€â”€ base64                    # æ ‡å‡† Base64 ç¼–è§£ç å™¨å®ä¾‹
â”‚   â”œâ”€â”€ base64Url                 # URL å®‰å…¨ Base64 ç¼–è§£ç å™¨å®ä¾‹ (-_ æ›¿ä»£ +/)
â”‚   â”œâ”€â”€ Base64Codec               # Base64 ç¼–è§£ç å™¨ç±»
â”‚   â”œâ”€â”€ Base64Encoder             # Base64 ç¼–ç å™¨
â”‚   â”œâ”€â”€ Base64Decoder             # Base64 è§£ç å™¨
â”‚   â”œâ”€â”€ Base64EncoderSink         # Base64 ç¼–ç  Sink (æµå¼)
â”‚   â””â”€â”€ Base64DecoderSink         # Base64 è§£ç  Sink (æµå¼)
â”‚
â”œâ”€â”€ HTML è½¬ä¹‰
â”‚   â”œâ”€â”€ HtmlEscape                # HTML ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰è½¬æ¢å™¨
â”‚   â”œâ”€â”€ HtmlEscapeMode            # è½¬ä¹‰æ¨¡å¼é…ç½® (element/attribute/sq/ dq å±æ€§)
â”‚   â””â”€â”€ htmlEscape                # é»˜è®¤ HtmlEscape å®ä¾‹
â”‚
â”œâ”€â”€ è¡Œå¤„ç†
â”‚   â””â”€â”€ LineSplitter              # æŒ‰è¡Œåˆ†å‰²å­—ç¬¦ä¸²è½¬æ¢å™¨ (\n \r\n)
â”‚
â”œâ”€â”€ è½¬æ¢å™¨æ¡†æ¶
â”‚   â”œâ”€â”€ Codec<S, T>               # ç¼–è§£ç å™¨æŠ½è±¡åŸºç±» (encoder + decoder)
â”‚   â”œâ”€â”€ Converter<S, T>           # å•å‘è½¬æ¢å™¨æŠ½è±¡åŸºç±»
â”‚   â”œâ”€â”€ Encoding                  # å­—ç¬¦ç¼–ç æŠ½è±¡åŸºç±» (ç»§æ‰¿ Codec<String, List<int>>)
â”‚   â”œâ”€â”€ ChunkedConversionSink<T>  # åˆ†å—è½¬æ¢æ¥æ”¶å™¨æ¥å£
â”‚   â”œâ”€â”€ ByteConversionSink        # å­—èŠ‚è½¬æ¢æ¥æ”¶å™¨æŠ½è±¡ç±»
â”‚   â”œâ”€â”€ ByteConversionSinkBase    # å­—èŠ‚è½¬æ¢æ¥æ”¶å™¨åŸºå®ç°
â”‚   â”œâ”€â”€ StringConversionSink      # å­—ç¬¦ä¸²è½¬æ¢æ¥æ”¶å™¨æŠ½è±¡ç±»
â”‚   â”œâ”€â”€ StringConversionSinkBase  # å­—ç¬¦ä¸²è½¬æ¢æ¥æ”¶å™¨åŸºå®ç°
â”‚   â””â”€â”€ ClosableStringSink        # å¯å…³é—­å­—ç¬¦ä¸²æ¥æ”¶å™¨æ¥å£
â”‚
â””â”€â”€ å“ˆå¸Œç è½¬æ¢ (å†…éƒ¨)
    â””â”€â”€ HashSink                  # å­—èŠ‚ Sink é€‚é…å™¨ (å†…éƒ¨å·¥å…·ç±»)
```



---

## ç¬¬1ç«  JSON ç¼–è§£ç 

JSONï¼ˆJavaScript Object Notationï¼‰æ˜¯ä¸€ç§è½»é‡çº§çš„æ•°æ®äº¤æ¢æ ¼å¼ï¼Œå¹¿æ³›åº”ç”¨äº Web APIã€é…ç½®æ–‡ä»¶å’Œæ•°æ®å­˜å‚¨ç­‰åœºæ™¯ã€‚`dart:convert` åº“æä¾›äº†å¼ºå¤§çš„ JSON ç¼–è§£ç åŠŸèƒ½ã€‚

### 1.1 jsonDecode - JSON è§£ç 

`jsonDecode` å‡½æ•°å°† JSON æ ¼å¼çš„å­—ç¬¦ä¸²è§£æä¸º Dart å¯¹è±¡ã€‚

#### 1.1.1 åŸºæœ¬ç”¨æ³•

```dart
import 'dart:convert';

void main() {
  // è§£æç®€å•å¯¹è±¡
  var jsonString = '{"name": "Alice", "age": 25}';
  var person = jsonDecode(jsonString);
  print(person);  // è¾“å‡º: {name: Alice, age: 25}
  print(person['name']);  // è¾“å‡º: Alice
  print(person['age']);   // è¾“å‡º: 25
  
  // è§£ææ•°ç»„
  var arrayJson = '[1, 2, 3, 4, 5]';
  var numbers = jsonDecode(arrayJson);
  print(numbers);  // è¾“å‡º: [1, 2, 3, 4, 5]
  
  // è§£æåµŒå¥—å¯¹è±¡
  var nestedJson = '''
  {
    "user": {
      "name": "Bob",
      "email": "bob@example.com"
    },
    "orders": [
      {"id": 1, "total": 100},
      {"id": 2, "total": 200}
    ]
  }
  ''';
  var data = jsonDecode(nestedJson);
  print(data['user']['name']);      // è¾“å‡º: Bob
  print(data['orders'][0]['total']); // è¾“å‡º: 100
}
```

#### 1.1.2 ç±»å‹è½¬æ¢

`jsonDecode` è¿”å›çš„æ˜¯ `dynamic` ç±»å‹ï¼Œé€šå¸¸éœ€è¦è¿›è¡Œç±»å‹è½¬æ¢ä»¥è·å¾—ç±»å‹å®‰å…¨ã€‚

```dart
import 'dart:convert';

void main() {
  var jsonString = '{"name": "Alice", "age": 25, "scores": [85, 90, 95]}';
  var decoded = jsonDecode(jsonString);
  
  // å®‰å…¨ç±»å‹è½¬æ¢
  var name = decoded['name'] as String;
  var age = decoded['age'] as int;
  var scores = (decoded['scores'] as List).cast<int>();
  
  print('Name: $name, Age: $age');
  print('Scores: $scores');
  
  // å¤„ç†å¯èƒ½ä¸º null çš„å­—æ®µ
  var nickname = decoded['nickname'] as String?;
  print('Nickname: ${nickname ?? "N/A"}');
  
  // å¤„ç†å¤æ‚åµŒå¥—ç»“æ„
  var usersJson = '''
  [
    {"id": 1, "name": "Alice"},
    {"id": 2, "name": "Bob"}
  ]
  ''';
  var users = (jsonDecode(usersJson) as List)
    .cast<Map<String, dynamic>>();
  
  for (var user in users) {
    print('User ${user['id']}: ${user['name']}');
  }
}
```

#### 1.1.3 å¸¦ reviver çš„è§£ç 

`jsonDecode` æ”¯æŒ `reviver` å‚æ•°ï¼Œå¯ä»¥åœ¨è§£æè¿‡ç¨‹ä¸­è½¬æ¢æ¯ä¸ªå¯¹è±¡æˆ–æ•°ç»„å…ƒç´ ã€‚

```dart
import 'dart:convert';

void main() {
  var jsonString = '''
  {
    "created_at": "2024-01-15T10:30:00Z",
    "updated_at": "2024-01-16T14:45:00Z",
    "data": {"value": 42}
  }
  ''';
  
  // ä½¿ç”¨ reviver è‡ªåŠ¨è½¬æ¢æ—¥æœŸå­—ç¬¦ä¸²
  var result = jsonDecode(jsonString, reviver: (key, value) {
    // æ£€æµ‹æ—¥æœŸå­—ç¬¦ä¸²å¹¶è½¬æ¢
    if (key != null && key.toString().endsWith('_at') && value is String) {
      try {
        return DateTime.parse(value);
      } catch (_) {
        return value;
      }
    }
    return value;
  });
  
  print(result['created_at']);  // è¾“å‡º: 2024-01-15 10:30:00.000Z
  print(result['created_at'] is DateTime);  // è¾“å‡º: true
}
```

### 1.2 jsonEncode - JSON ç¼–ç 

`jsonEncode` å‡½æ•°å°† Dart å¯¹è±¡è½¬æ¢ä¸º JSON æ ¼å¼çš„å­—ç¬¦ä¸²ã€‚

#### 1.2.1 åŸºæœ¬ç”¨æ³•

```dart
import 'dart:convert';

void main() {
  // ç¼–ç  Map
  var person = {'name': 'Alice', 'age': 25};
  var jsonString = jsonEncode(person);
  print(jsonString);  // è¾“å‡º: {"name":"Alice","age":25}
  
  // ç¼–ç  List
  var numbers = [1, 2, 3, 4, 5];
  print(jsonEncode(numbers));  // è¾“å‡º: [1,2,3,4,5]
  
  // ç¼–ç åµŒå¥—ç»“æ„
  var data = {
    'user': {'name': 'Bob', 'email': 'bob@example.com'},
    'tags': ['developer', 'dart', 'flutter'],
    'active': true,
    'score': null,
  };
  print(jsonEncode(data));
  // è¾“å‡º: {"user":{"name":"Bob","email":"bob@example.com"},"tags":["developer","dart","flutter"],"active":true,"score":null}
}
```

#### 1.2.2 toJson æ–¹æ³•

å¯¹äºè‡ªå®šä¹‰ç±»ï¼Œå¯ä»¥å®ç° `toJson()` æ–¹æ³•æ¥æ”¯æŒ JSON ç¼–ç ã€‚

```dart
import 'dart:convert';

class Person {
  final String name;
  final int age;
  final String? email;
  final List<String> hobbies;
  
  Person({
    required this.name,
    required this.age,
    this.email,
    this.hobbies = const [],
  });
  
  // å®ç° toJson æ–¹æ³•
  Map<String, dynamic> toJson() => {
    'name': name,
    'age': age,
    if (email != null) 'email': email,
    if (hobbies.isNotEmpty) 'hobbies': hobbies,
  };
  
  // ä» JSON åˆ›å»ºå¯¹è±¡
  factory Person.fromJson(Map<String, dynamic> json) {
    return Person(
      name: json['name'] as String,
      age: json['age'] as int,
      email: json['email'] as String?,
      hobbies: (json['hobbies'] as List?)?.cast<String>() ?? [],
    );
  }
}

void main() {
  var person = Person(
    name: 'Alice',
    age: 25,
    email: 'alice@example.com',
    hobbies: ['reading', 'coding'],
  );
  
  // ç¼–ç ï¼ˆè‡ªåŠ¨è°ƒç”¨ toJsonï¼‰
  var jsonString = jsonEncode(person);
  print(jsonString);
  // è¾“å‡º: {"name":"Alice","age":25,"email":"alice@example.com","hobbies":["reading","coding"]}
  
  // è§£ç 
  var decoded = jsonDecode(jsonString) as Map<String, dynamic>;
  var restored = Person.fromJson(decoded);
  print('${restored.name}, ${restored.age}');  // è¾“å‡º: Alice, 25
}
```

#### 1.2.3 å¸¦ toEncodable çš„ç¼–ç 

`jsonEncode` æ”¯æŒ `toEncodable` å‚æ•°ï¼Œç”¨äºå¤„ç†æ— æ³•ç›´æ¥ç¼–ç çš„å¯¹è±¡ã€‚

```dart
import 'dart:convert';

class Product {
  final String id;
  final String name;
  final DateTime createdAt;
  
  Product(this.id, this.name, this.createdAt);
  
  Map<String, dynamic> toJson() => {
    'id': id,
    'name': name,
    'createdAt': createdAt.toIso8601String(),
  };
}

void main() {
  var products = [
    Product('P001', 'iPhone', DateTime(2024, 1, 15)),
    Product('P002', 'iPad', DateTime(2024, 1, 16)),
  ];
  
  // ä½¿ç”¨ toEncodable å¤„ç†è‡ªå®šä¹‰å¯¹è±¡
  var jsonString = jsonEncode(products, toEncodable: (object) {
    if (object is Product) {
      return object.toJson();
    }
    return object.toString();
  });
  
  print(jsonString);
  // è¾“å‡º: [{"id":"P001","name":"iPhone","createdAt":"2024-01-15T00:00:00.000"},{"id":"P002","name":"iPad","createdAt":"2024-01-16T00:00:00.000"}]
}
```

### 1.3 JsonEncoder å’Œ JsonDecoder ç±»

`JsonEncoder` å’Œ `JsonDecoder` ç±»æä¾›äº†æ›´ç»†ç²’åº¦çš„ JSON ç¼–è§£ç æ§åˆ¶ã€‚

#### 1.3.1 JsonEncoder

```dart
import 'dart:convert';

void main() {
  var data = {'name': 'Alice', 'items': [1, 2, 3]};
  
  // é»˜è®¤ç¼–ç å™¨
  var encoder1 = JsonEncoder();
  print(encoder1.convert(data));
  // è¾“å‡º: {"name":"Alice","items":[1,2,3]}
  
  // å¸¦ç¼©è¿›çš„ç¼–ç å™¨
  var encoder2 = JsonEncoder.withIndent('  ');
  print(encoder2.convert(data));
  // è¾“å‡º:
  // {
  //   "name": "Alice",
  //   "items": [
  //     1,
  //     2,
  //     3
  //   ]
  // }
  
  // è‡ªå®šä¹‰ç¼©è¿›ï¼ˆåˆ¶è¡¨ç¬¦ï¼‰
  var encoder3 = JsonEncoder.withIndent('\t');
  print(encoder3.convert(data));
}
```

#### 1.3.2 JsonDecoder

```dart
import 'dart:convert';

void main() {
  var jsonString = '{"name": "Alice", "age": 25}';
  
  // åˆ›å»ºè§£ç å™¨
  var decoder = JsonDecoder();
  var result = decoder.convert(jsonString);
  print(result);  // è¾“å‡º: {name: Alice, age: 25}
  
  // å¸¦ reviver çš„è§£ç å™¨
  var decoderWithReviver = JsonDecoder((key, value) {
    if (key == 'age' && value is int) {
      return value * 2;  // å°†æ‰€æœ‰ age å€¼ç¿»å€
    }
    return value;
  });
  
  var result2 = decoderWithReviver.convert(jsonString);
  print(result2);  // è¾“å‡º: {name: Alice, age: 50}
}
```

#### 1.3.3 JsonCodec

`JsonCodec` å°†ç¼–ç å™¨å’Œè§£ç å™¨ç»„åˆåœ¨ä¸€èµ·ã€‚

```dart
import 'dart:convert';

void main() {
  // åˆ›å»ºç¼–è§£ç å™¨
  var codec = JsonCodec();
  
  // ç¼–ç 
  var data = {'message': 'Hello'};
  var encoded = codec.encode(data);
  print(encoded);  // è¾“å‡º: {"message":"Hello"}
  
  // è§£ç 
  var decoded = codec.decode(encoded);
  print(decoded);  // è¾“å‡º: {message: Hello}
  
  // å¸¦è‡ªå®šä¹‰é…ç½®çš„ç¼–è§£ç å™¨
  var customCodec = JsonCodec(
    reviver: (key, value) => value,
    toEncodable: (object) => object.toString(),
  );
}
```

### 1.4 JSON æµå¼ç¼–è§£ç 

å¯¹äºå¤§é‡æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨æµå¼ç¼–è§£ç æ¥å‡å°‘å†…å­˜å ç”¨ã€‚

```dart
import 'dart:convert';
import 'dart:async';

void main() async {
  // æµå¼è§£ç 
  var jsonStream = Stream.fromIterable([
    '{"users": [',
    '{"name": "Alice"},',
    '{"name": "Bob"}',
    ']}',
  ]);
  
  // æ³¨æ„ï¼šJsonDecoder ä¸æ”¯æŒåˆ†å—è§£ç  JSON
  // éœ€è¦å…ˆå°†æµåˆå¹¶ä¸ºå®Œæ•´å­—ç¬¦ä¸²
  var fullJson = await jsonStream.join();
  var result = jsonDecode(fullJson);
  print(result);
  
  // ä½¿ç”¨ JsonUtf8Encoder è¿›è¡Œæµå¼ç¼–ç 
  var encoder = JsonUtf8Encoder();
  var objectStream = Stream.fromIterable([
    {'id': 1},
    {'id': 2},
    {'id': 3},
  ]);
  
  // å°†å¯¹è±¡æµè½¬æ¢ä¸º UTF-8 å­—èŠ‚æµ
  var byteStream = objectStream.transform(encoder);
  await for (var bytes in byteStream) {
    print('Encoded bytes: $bytes');
  }
}
```

**Dart Tips è¯­æ³•å°è´´å£«**

JSON ç¼–ç çš„æ€§èƒ½è€ƒè™‘

å¯¹äºå¤§é‡æ•°æ®çš„ JSON ç¼–ç ï¼Œå»ºè®®ä½¿ç”¨ `JsonEncoder` çš„æµå¼ API æˆ–åˆ†æ‰¹å¤„ç†ï¼š

```dart
// å¯¹äºå¤§é‡æ•°æ®ï¼Œé¿å…ä¸€æ¬¡æ€§ç¼–ç 
// ä¸æ¨èï¼šjsonEncode(hugeList)

// æ¨èï¼šåˆ†æ‰¹ç¼–ç 
var encoder = JsonEncoder();
for (var chunk in hugeList.chunks(1000)) {
  var jsonChunk = encoder.convert(chunk);
  // å¤„ç†æˆ–å‘é€ chunk
}
```

## ç¬¬2ç«  å­—ç¬¦ç¼–ç 

`dart:convert` åº“æä¾›äº†å¤šç§å­—ç¬¦ç¼–ç çš„æ”¯æŒï¼ŒåŒ…æ‹¬ UTF-8ã€Latin-1 (ISO-8859-1) å’Œ ASCIIã€‚

### 2.1 UTF-8 ç¼–ç 

UTF-8 æ˜¯æœ€å¸¸ç”¨çš„å­—ç¬¦ç¼–ç ï¼Œæ”¯æŒæ‰€æœ‰ Unicode å­—ç¬¦ã€‚

#### 2.1.1 utf8 ç¼–è§£ç å™¨

```dart
import 'dart:convert';

void main() {
  var text = 'Hello, ä¸–ç•Œ! ğŸŒ';
  
  // ç¼–ç ä¸º UTF-8 å­—èŠ‚
  List<int> bytes = utf8.encode(text);
  print(bytes);  // è¾“å‡º: [72, 101, 108, 108, 111, 44, 32, 228, 184, 150, 231, 149, 140, 33, 32, 240, 159, 140, 141]
  
  // è§£ç  UTF-8 å­—èŠ‚
  var decoded = utf8.decode(bytes);
  print(decoded);  // è¾“å‡º: Hello, ä¸–ç•Œ! ğŸŒ
  
  // ä½¿ç”¨ç¼–è§£ç å™¨å¯¹è±¡
  var encoded2 = utf8.encoder.convert(text);
  print(encoded2);
  
  var decoded2 = utf8.decoder.convert(encoded2);
  print(decoded2);
}
```

#### 2.1.2 å¤„ç†æ— æ•ˆå­—èŠ‚åºåˆ—

```dart
import 'dart:convert';

void main() {
  // åŒ…å«æ— æ•ˆ UTF-8 åºåˆ—çš„å­—èŠ‚
  var invalidBytes = [0x80, 0x81, 0x82];  // æ— æ•ˆçš„ UTF-8 åºåˆ—
  
  // é»˜è®¤æƒ…å†µä¸‹ä¼šæŠ›å‡ºå¼‚å¸¸
  try {
    utf8.decode(invalidBytes);
  } catch (e) {
    print('Decode error: $e');
  }
  
  // å…è®¸æ— æ•ˆåºåˆ—ï¼ˆæ›¿æ¢ä¸ºæ›¿æ¢å­—ç¬¦ U+FFFDï¼‰
  var decoded = utf8.decode(invalidBytes, allowMalformed: true);
  print(decoded);  // è¾“å‡º: ï¿½ï¿½ï¿½ï¼ˆæ›¿æ¢å­—ç¬¦ï¼‰
  
  // ä½¿ç”¨è§£ç å™¨æ„é€ å‡½æ•°
  var decoder = Utf8Decoder(allowMalformed: true);
  var result = decoder.convert(invalidBytes);
  print(result);
}
```

#### 2.1.3 æµå¼ UTF-8 ç¼–è§£ç 

```dart
import 'dart:convert';
import 'dart:io';

void main() async {
  // æ¨¡æ‹Ÿå­—èŠ‚æµ
  var byteStream = Stream.fromIterable([
    [72, 101, 108, 108],  // "Hell"
    [111, 44, 32],         // "o, "
    [228, 184, 150, 231],  // "ä¸–" çš„éƒ¨åˆ†
    [149, 140],            // "ä¸–" çš„å‰©ä½™éƒ¨åˆ†
  ]);
  
  // å°†å­—èŠ‚æµè½¬æ¢ä¸ºå­—ç¬¦ä¸²æµ
  var stringStream = byteStream.transform(utf8.decoder);
  await for (var chunk in stringStream) {
    print('Chunk: $chunk');
  }
  // è¾“å‡º:
  // Chunk: Hell
  // Chunk: o, 
  // Chunk: ä¸–
  
  // å°†å­—ç¬¦ä¸²æµè½¬æ¢ä¸ºå­—èŠ‚æµ
  var textStream = Stream.fromIterable(['Hello', ', ', 'World']);
  var encodedStream = textStream.transform(utf8.encoder);
  await for (var bytes in encodedStream) {
    print('Bytes: $bytes');
  }
}
```

### 2.2 Latin-1 ç¼–ç 

Latin-1 (ISO-8859-1) æ˜¯ä¸€ç§å•å­—èŠ‚ç¼–ç ï¼Œæ”¯æŒè¥¿æ¬§è¯­è¨€ã€‚

```dart
import 'dart:convert';

void main() {
  // Latin-1 ç¼–ç 
  var text = 'CafÃ© rÃ©sumÃ©';
  var bytes = latin1.encode(text);
  print(bytes);  // è¾“å‡º: [67, 97, 102, 233, 32, 114, 233, 115, 117, 109, 233]
  
  // Latin-1 è§£ç 
  var decoded = latin1.decode(bytes);
  print(decoded);  // è¾“å‡º: CafÃ© rÃ©sumÃ©
  
  // æ³¨æ„ï¼šLatin-1 ä¸æ”¯æŒä¸­æ–‡ç­‰éè¥¿æ¬§å­—ç¬¦
  try {
    latin1.encode('ä¸­æ–‡');  // ä¼šæŠ›å‡ºå¼‚å¸¸
  } catch (e) {
    print('Latin-1 cannot encode Chinese: $e');
  }
}
```

### 2.3 ASCII ç¼–ç 

ASCII æ˜¯æœ€åŸºæœ¬çš„å­—ç¬¦ç¼–ç ï¼Œåªæ”¯æŒ 128 ä¸ªå­—ç¬¦ã€‚

```dart
import 'dart:convert';

void main() {
  // ASCII ç¼–ç 
  var text = 'Hello, World!';
  var bytes = ascii.encode(text);
  print(bytes);  // è¾“å‡º: [72, 101, 108, 108, 111, 44, 32, 87, 111, 114, 108, 100, 33]
  
  // ASCII è§£ç 
  var decoded = ascii.decode(bytes);
  print(decoded);  // è¾“å‡º: Hello, World!
  
  // ASCII åªæ”¯æŒ 0-127 çš„å­—ç¬¦
  try {
    ascii.encode('CafÃ©');  // Ã© (233) è¶…å‡º ASCII èŒƒå›´
  } catch (e) {
    print('ASCII cannot encode Ã©: $e');
  }
  
  // å…è®¸é ASCII å­—ç¬¦ï¼ˆæ›¿æ¢ä¸º ?ï¼‰
  var encoder = AsciiEncoder(allowInvalid: true);
  var result = encoder.convert('CafÃ©');
  print(result);  // è¾“å‡º: [67, 97, 102, 63]ï¼ˆÃ© è¢«æ›¿æ¢ä¸º ?ï¼‰
}
```

### 2.4 ç¼–ç æ£€æµ‹ä¸è‡ªåŠ¨é€‰æ‹©

```dart
import 'dart:convert';

void main() {
  var bytes = [72, 101, 108, 108, 111];  // "Hello"
  
  // å°è¯•ä½¿ç”¨ä¸åŒç¼–ç è§£ç 
  String? tryDecode(List<int> bytes, Encoding encoding) {
    try {
      return encoding.decode(bytes);
    } catch (_) {
      return null;
    }
  }
  
  // æŒ‰ä¼˜å…ˆçº§å°è¯•
  var encodings = [utf8, latin1, ascii];
  for (var encoding in encodings) {
    var result = tryDecode(bytes, encoding);
    if (result != null) {
      print('Decoded with ${encoding.name}: $result');
      break;
    }
  }
}
```

## ç¬¬3ç«  Base64 ç¼–ç 

Base64 æ˜¯ä¸€ç§å°†äºŒè¿›åˆ¶æ•°æ®ç¼–ç ä¸º ASCII å­—ç¬¦ä¸²çš„æ–¹æ³•ï¼Œå¸¸ç”¨äºæ•°æ®ä¼ è¾“å’Œå­˜å‚¨ã€‚

### 3.1 Base64 ç¼–è§£ç 

#### 3.1.1 åŸºæœ¬ç”¨æ³•

```dart
import 'dart:convert';

void main() {
  // åŸå§‹æ•°æ®
  var bytes = [72, 101, 108, 108, 111];  // "Hello"
  
  // Base64 ç¼–ç 
  var encoded = base64.encode(bytes);
  print(encoded);  // è¾“å‡º: SGVsbG8=
  
  // Base64 è§£ç 
  var decoded = base64.decode(encoded);
  print(decoded);  // è¾“å‡º: [72, 101, 108, 108, 111]
  
  // ä½¿ç”¨ç¼–è§£ç å™¨
  var encoded2 = base64.encoder.convert(bytes);
  var decoded2 = base64.decoder.convert(encoded2);
  print('Round-trip: $decoded2');
}
```

#### 3.1.2 Base64 URL å®‰å…¨ç¼–ç 

```dart
import 'dart:convert';

void main() {
  // URL å®‰å…¨çš„ Base64 ç¼–ç ï¼ˆå°† + æ›¿æ¢ä¸º -ï¼Œ/ æ›¿æ¢ä¸º _ï¼Œçœç•¥ = å¡«å……ï¼‰
  var bytes = [251, 252, 253, 254, 255];
  
  // æ ‡å‡† Base64
  var standard = base64.encode(bytes);
  print('Standard: $standard');  // è¾“å‡º: +/z9/v8=
  
  // URL å®‰å…¨ Base64
  var urlSafe = base64Url.encode(bytes);
  print('URL Safe: $urlSafe');  // è¾“å‡º: _/z9_v8=
  
  // URL å®‰å…¨ç¼–ç é€‚ç”¨äº URL å‚æ•°
  var url = 'https://example.com/data?token=$urlSafe';
  print(url);
}
```

#### 3.1.3 å¤„ç†å­—ç¬¦ä¸²æ•°æ®

```dart
import 'dart:convert';

void main() {
  // å°†å­—ç¬¦ä¸²ç¼–ç ä¸º Base64
  var text = 'Hello, World!';
  var bytes = utf8.encode(text);
  var base64String = base64.encode(bytes);
  print('Base64: $base64String');  // è¾“å‡º: SGVsbG8sIFdvcmxkIQ==
  
  // è§£ç å›å­—ç¬¦ä¸²
  var decodedBytes = base64.decode(base64String);
  var decodedText = utf8.decode(decodedBytes);
  print('Decoded: $decodedText');  // è¾“å‡º: Hello, World!
  
  // ä¾¿æ·å‡½æ•°
  String encodeString(String text) => base64.encode(utf8.encode(text));
  String decodeString(String base64Text) => utf8.decode(base64.decode(base64Text));
  
  print(decodeString(encodeString('Test')));  // è¾“å‡º: Test
}
```

### 3.2 Base64 ç¼–ç é€‰é¡¹

```dart
import 'dart:convert';

void main() {
  var bytes = [72, 101, 108, 108, 111];  // "Hello"
  
  // æ ‡å‡† Base64
  var standard = base64.encode(bytes);
  print('Standard: $standard');  // SGVsbG8=
  
  // ä¸å¸¦å¡«å……
  var noPadding = base64Encode(bytes, urlSafe: false, addPadding: false);
  // æ³¨æ„ï¼šdart:convert ä¸ç›´æ¥æ”¯æŒæ­¤é€‰é¡¹ï¼Œéœ€è¦è‡ªå®šä¹‰
  
  // ä½¿ç”¨ Base64Codec è‡ªå®šä¹‰
  var codec = Base64Codec();
  print(codec.encode(bytes));  // SGVsbG8=
  
  // URL å®‰å…¨ç¼–è§£ç å™¨
  var urlCodec = Base64Codec.urlSafe();
  print(urlCodec.encode([251, 252]));  // -_w=
}
```

### 3.3 å®æˆ˜åº”ç”¨ï¼šå›¾ç‰‡ Base64 ç¼–ç 

```dart
import 'dart:convert';
import 'dart:io';

Future<String> imageToBase64(String filePath) async {
  var file = File(filePath);
  var bytes = await file.readAsBytes();
  return base64.encode(bytes);
}

Future<void> base64ToImage(String base64String, String outputPath) async {
  var bytes = base64.decode(base64String);
  var file = File(outputPath);
  await file.writeAsBytes(bytes);
}

void main() async {
  // å°†å›¾ç‰‡è½¬ä¸º Base64ï¼ˆç”¨äº Web åµŒå…¥ï¼‰
  // var base64Image = await imageToBase64('image.png');
  // var dataUrl = 'data:image/png;base64,$base64Image';
  
  // ä» Base64 æ¢å¤å›¾ç‰‡
  // await base64ToImage(base64Image, 'restored.png');
}
```

## ç¬¬4ç«  è¡Œåˆ†å‰²å™¨ï¼ˆLineSplitterï¼‰

`LineSplitter` æ˜¯ä¸€ä¸ª `StreamTransformer`ï¼Œç”¨äºå°†å­—ç¬¦ä¸²æµæŒ‰è¡Œåˆ†å‰²ã€‚

### 4.1 åŸºæœ¬ç”¨æ³•

```dart
import 'dart:convert';

void main() {
  var splitter = LineSplitter();
  
  // åˆ†å‰²åŒ…å«ä¸åŒæ¢è¡Œç¬¦çš„æ–‡æœ¬
  var text = 'Line 1\nLine 2\r\nLine 3\rLine 4';
  var lines = splitter.convert(text);
  
  for (var i = 0; i < lines.length; i++) {
    print('$i: "${lines[i]}"');
  }
  // è¾“å‡º:
  // 0: "Line 1"
  // 1: "Line 2"
  // 2: "Line 3"
  // 3: "Line 4"
}
```

### 4.2 æµå¼è¡Œåˆ†å‰²

```dart
import 'dart:convert';

void main() async {
  // æ¨¡æ‹Ÿé€å—æ¥æ”¶çš„æ–‡æœ¬æµ
  var textStream = Stream.fromIterable([
    'First line\nSecond',
    ' line continued\nThird',
    ' line\n',
  ]);
  
  // åº”ç”¨è¡Œåˆ†å‰²è½¬æ¢
  var lineStream = textStream.transform(LineSplitter());
  
  await for (var line in lineStream) {
    print('Line: "$line"');
  }
  // è¾“å‡º:
  // Line: "First line"
  // Line: "Second line continued"
  // Line: "Third line"
}
```

### 4.3 ä»æ–‡ä»¶è¯»å–è¡Œ

```dart
import 'dart:convert';
import 'dart:io';

Future<void> readFileLines(String filePath) async {
  var file = File(filePath);
  
  // æ–¹æ³•1ï¼šè¯»å–å…¨éƒ¨å†…å®¹ååˆ†å‰²
  var content = await file.readAsString();
  var lines = LineSplitter.split(content);
  for (var line in lines) {
    print(line);
  }
  
  // æ–¹æ³•2ï¼šæµå¼è¯»å–ï¼ˆé€‚åˆå¤§æ–‡ä»¶ï¼‰
  await for (var line in file
    .openRead()
    .transform(utf8.decoder)
    .transform(LineSplitter())) {
    print(line);
  }
}

void main() async {
  // åˆ›å»ºæµ‹è¯•æ–‡ä»¶
  var testFile = File('test.txt');
  await testFile.writeAsString('Line 1\nLine 2\nLine 3');
  
  // è¯»å–
  await readFileLines('test.txt');
  
  // æ¸…ç†
  await testFile.delete();
}
```

### 4.4 å¤„ç†æ ‡å‡†è¾“å…¥

```dart
import 'dart:convert';
import 'dart:io';

void main() {
  print('Enter lines (Ctrl+D to exit):');
  
  stdin
    .transform(utf8.decoder)
    .transform(LineSplitter())
    .listen(
      (line) => print('Received: $line'),
      onDone: () => print('Input closed'),
    );
}
```

## ç¬¬5ç«  Codec å’Œ Converter æ¡†æ¶

`dart:convert` åº“æä¾›äº†ä¸€å¥—çµæ´»çš„ç¼–è§£ç å™¨æ¡†æ¶ï¼Œå…è®¸å¼€å‘è€…åˆ›å»ºè‡ªå®šä¹‰çš„ç¼–è§£ç å™¨ã€‚

### 5.1 Codec ç±»

`Codec<S, T>` æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œè¡¨ç¤ºä»ç±»å‹ `S` åˆ°ç±»å‹ `T` çš„ç¼–ç å’Œè§£ç èƒ½åŠ›ã€‚

```dart
import 'dart:convert';

// è‡ªå®šä¹‰ç¼–è§£ç å™¨ï¼šå°†å­—ç¬¦ä¸²è¿›è¡Œç®€å•æ›¿æ¢åŠ å¯†
class CaesarCodec extends Codec<String, String> {
  final int shift;
  
  CaesarCodec(this.shift);
  
  @override
  Converter<String, String> get encoder => CaesarEncoder(shift);
  
  @override
  Converter<String, String> get decoder => CaesarDecoder(shift);
  
  @override
  CaesarCodec get inverted => CaesarCodec(-shift);
}

class CaesarEncoder extends Converter<String, String> {
  final int shift;
  CaesarEncoder(this.shift);
  
  @override
  String convert(String input) {
    return input.runes.map((rune) {
      if (rune >= 65 && rune <= 90) {  // A-Z
        return String.fromCharCode(65 + (rune - 65 + shift) % 26);
      } else if (rune >= 97 && rune <= 122) {  // a-z
        return String.fromCharCode(97 + (rune - 97 + shift) % 26);
      }
      return String.fromCharCode(rune);
    }).join();
  }
}

class CaesarDecoder extends Converter<String, String> {
  final int shift;
  CaesarDecoder(this.shift);
  
  @override
  String convert(String input) {
    return CaesarEncoder(-shift).convert(input);
  }
}

void main() {
  var codec = CaesarCodec(3);  // å‡¯æ’’å¯†ç ï¼Œç§»ä½3
  
  var original = 'Hello, World!';
  var encoded = codec.encode(original);
  var decoded = codec.decode(encoded);
  
  print('Original: $original');  // Hello, World!
  print('Encoded: $encoded');    // Khoor, Zruog!
  print('Decoded: $decoded');    // Hello, World!
}
```

### 5.2 Converter ç±»

`Converter<S, T>` æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œç”¨äºå°†æ•°æ®ä»ä¸€ç§è¡¨ç¤ºè½¬æ¢ä¸ºå¦ä¸€ç§è¡¨ç¤ºã€‚

```dart
import 'dart:convert';

// è‡ªå®šä¹‰è½¬æ¢å™¨ï¼šå°†æ•´æ•°åˆ—è¡¨è½¬æ¢ä¸ºé€—å·åˆ†éš”çš„å­—ç¬¦ä¸²
class IntListToCsvConverter extends Converter<List<int>, String> {
  @override
  String convert(List<int> input) {
    return input.join(',');
  }
}

// åå‘è½¬æ¢å™¨
class CsvToIntListConverter extends Converter<String, List<int>> {
  @override
  List<int> convert(String input) {
    if (input.isEmpty) return [];
    return input.split(',').map(int.parse).toList();
  }
}

void main() {
  var numbers = [1, 2, 3, 4, 5];
  
  var toCsv = IntListToCsvConverter();
  var csv = toCsv.convert(numbers);
  print(csv);  // è¾“å‡º: 1,2,3,4,5
  
  var fromCsv = CsvToIntListConverter();
  var restored = fromCsv.convert(csv);
  print(restored);  // è¾“å‡º: [1, 2, 3, 4, 5]
}
```

### 5.3 æµå¼è½¬æ¢ï¼ˆChunkedConversionSinkï¼‰

å¯¹äºå¤§é‡æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ `ChunkedConversionSink` è¿›è¡Œæµå¼è½¬æ¢ã€‚

```dart
import 'dart:convert';

// è‡ªå®šä¹‰æµå¼è½¬æ¢å™¨ï¼šç´¯ç§¯æ‰€æœ‰è¾“å…¥åè½¬æ¢
class AccumulatingConverter extends Converter<List<int>, String> {
  @override
  String convert(List<int> input) {
    return String.fromCharCodes(input);
  }
  
  @override
  Sink<List<int>> startChunkedConversion(Sink<String> sink) {
    return _AccumulatingSink(sink);
  }
}

class _AccumulatingSink extends ChunkedConversionSink<List<int>> {
  final Sink<String> _outputSink;
  final List<int> _accumulated = [];
  
  _AccumulatingSink(this._outputSink);
  
  @override
  void add(List<int> chunk) {
    _accumulated.addAll(chunk);
  }
  
  @override
  void close() {
    _outputSink.add(String.fromCharCodes(_accumulated));
    _outputSink.close();
  }
}

void main() {
  var converter = AccumulatingConverter();
  
  // åˆ›å»ºè¾“å‡º sink
  var output = StringBuffer();
  var sink = converter.startChunkedConversion(
    _StringSinkAdapter(output),
  );
  
  // åˆ†å—æ·»åŠ æ•°æ®
  sink.add([72, 101, 108]);   // "Hel"
  sink.add([108, 111]);        // "lo"
  sink.close();
  
  print(output.toString());  // è¾“å‡º: Hello
}

class _StringSinkAdapter implements Sink<String> {
  final StringBuffer _buffer;
  _StringSinkAdapter(this._buffer);
  
  @override
  void add(String data) => _buffer.write(data);
  
  @override
  void close() {}
}
```

### 5.4 ç»„åˆè½¬æ¢å™¨

```dart
import 'dart:convert';

// ç»„åˆå¤šä¸ªè½¬æ¢å™¨
void main() {
  // å®šä¹‰è½¬æ¢æµç¨‹ï¼šå¯¹è±¡ -> JSON å­—ç¬¦ä¸² -> UTF-8 å­—èŠ‚ -> Base64
  var objectToJson = JsonEncoder();
  var stringToUtf8 = utf8.encoder;
  var bytesToBase64 = base64.encoder;
  
  // é“¾å¼è½¬æ¢
  var data = {'message': 'Hello', 'count': 42};
  
  // æ‰‹åŠ¨é“¾å¼è°ƒç”¨
  var json = objectToJson.convert(data);
  var bytes = stringToUtf8.convert(json);
  var base64String = bytesToBase64.convert(bytes);
  
  print('Base64: $base64String');
  
  // åå‘è§£ç 
  var decodedBytes = base64.decoder.convert(base64String);
  var decodedJson = utf8.decoder.convert(decodedBytes);
  var decodedObject = JsonDecoder().convert(decodedJson);
  
  print('Decoded: $decodedObject');
}
```

## ç¬¬6ç«  HTML è½¬ä¹‰

`HtmlEscape` è½¬æ¢å™¨ç”¨äºå°†ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰ä¸º HTML å®ä½“ï¼Œé˜²æ­¢ XSS æ”»å‡»ã€‚

### 6.1 åŸºæœ¬ç”¨æ³•

```dart
import 'dart:convert';

void main() {
  var html = '<script>alert("XSS")</script>';
  
  // è½¬ä¹‰ HTML ç‰¹æ®Šå­—ç¬¦
  var escaped = const HtmlEscape().convert(html);
  print(escaped);
  // è¾“å‡º: &lt;script&gt;alert(&quot;XSS&quot;)&lt;/script&gt;
  
  // ä½¿ç”¨ä¸åŒçš„è½¬ä¹‰æ¨¡å¼
  var unknownMode = HtmlEscapeMode.unknown;
  var attributeMode = HtmlEscapeMode.attribute;
  var elementMode = HtmlEscapeMode.element;
  var sqAttributeMode = HtmlEscapeMode.sqAttribute;
  
  // å…ƒç´ æ¨¡å¼ï¼ˆè½¬ä¹‰ < > & "ï¼‰
  print(HtmlEscape(elementMode).convert('<div>Hello & "World"</div>'));
  // è¾“å‡º: &lt;div&gt;Hello &amp; &quot;World&quot;&lt;/div&gt;
  
  // å±æ€§æ¨¡å¼ï¼ˆè½¬ä¹‰ < > & " 'ï¼‰
  print(HtmlEscape(attributeMode).convert('value="test"\'s'));
}
```

### 6.2 å®æˆ˜åº”ç”¨ï¼šå®‰å…¨çš„ HTML æ¸²æŸ“

```dart
import 'dart:convert';

String safeHtml(String userInput) {
  return const HtmlEscape(HtmlEscapeMode.element).convert(userInput);
}

void main() {
  var userComment = '<b>Bold</b> <script>alert("hack")</script>';
  var safe = safeHtml(userComment);
  
  // å¯ä»¥å®‰å…¨åœ°åµŒå…¥ HTML
  print('<div class="comment">$safe</div>');
  // è¾“å‡º: <div class="comment">&lt;b&gt;Bold&lt;/b&gt; &lt;script&gt;alert(&quot;hack&quot;)&lt;/script&gt;</div>
}
```

## ç¬¬7ç«  å®æˆ˜åº”ç”¨ç¤ºä¾‹

### 7.1 é…ç½®æ–‡ä»¶çš„è¯»å†™

```dart
import 'dart:convert';
import 'dart:io';

class ConfigManager {
  final String filePath;
  Map<String, dynamic> _config = {};
  
  ConfigManager(this.filePath);
  
  Future<void> load() async {
    var file = File(filePath);
    if (await file.exists()) {
      var content = await file.readAsString();
      _config = jsonDecode(content) as Map<String, dynamic>;
    }
  }
  
  Future<void> save() async {
    var file = File(filePath);
    var encoder = JsonEncoder.withIndent('  ');
    await file.writeAsString(encoder.convert(_config));
  }
  
  T? get<T>(String key) => _config[key] as T?;
  
  void set<T>(String key, T value) {
    _config[key] = value;
  }
  
  void remove(String key) {
    _config.remove(key);
  }
}

void main() async {
  var config = ConfigManager('config.json');
  
  config.set('apiUrl', 'https://api.example.com');
  config.set('timeout', 30);
  config.set('features', {'darkMode': true, 'notifications': false});
  
  await config.save();
  
  await config.load();
  print(config.get<String>('apiUrl'));
  print(config.get<Map<String, dynamic>>('features'));
}
```

### 7.2 æ—¥å¿—æ–‡ä»¶çš„æµå¼å¤„ç†

```dart
import 'dart:convert';
import 'dart:io';

Stream<Map<String, dynamic>> parseLogFile(String filePath) async* {
  var file = File(filePath);
  
  await for (var line in file
    .openRead()
    .transform(utf8.decoder)
    .transform(LineSplitter())) {
    if (line.trim().isEmpty) continue;
    
    try {
      yield jsonDecode(line) as Map<String, dynamic>;
    } catch (e) {
      // å¿½ç•¥æ— æ•ˆè¡Œ
      print('Invalid log line: $line');
    }
  }
}

void main() async {
  // åˆ›å»ºæµ‹è¯•æ—¥å¿—æ–‡ä»¶
  var logFile = File('app.log');
  var logs = [
    {'level': 'INFO', 'message': 'Application started', 'timestamp': DateTime.now().toIso8601String()},
    {'level': 'ERROR', 'message': 'Connection failed', 'timestamp': DateTime.now().toIso8601String()},
    {'level': 'INFO', 'message': 'Retrying...', 'timestamp': DateTime.now().toIso8601String()},
  ];
  
  await logFile.writeAsString(
    logs.map((l) => jsonEncode(l)).join('\n'),
  );
  
  // æµå¼è§£æ
  await for (var log in parseLogFile('app.log')) {
    print('[${log['level']}] ${log['message']}');
  }
  
  // æ¸…ç†
  await logFile.delete();
}
```

### 7.3 API å“åº”çš„ç»Ÿä¸€å¤„ç†

```dart
import 'dart:convert';

class ApiResponse<T> {
  final bool success;
  final T? data;
  final String? error;
  final int statusCode;
  
  ApiResponse({
    required this.success,
    this.data,
    this.error,
    required this.statusCode,
  });
  
  factory ApiResponse.fromJson(
    Map<String, dynamic> json,
    T Function(dynamic) fromJson,
  ) {
    return ApiResponse(
      success: json['success'] as bool,
      data: json['data'] != null ? fromJson(json['data']) : null,
      error: json['error'] as String?,
      statusCode: json['statusCode'] as int,
    );
  }
  
  Map<String, dynamic> toJson(Object? Function(T) toJson) => {
    'success': success,
    if (data != null) 'data': toJson(data as T),
    if (error != null) 'error': error,
    'statusCode': statusCode,
  };
}

// ä½¿ç”¨ç¤ºä¾‹
class User {
  final String id;
  final String name;
  
  User({required this.id, required this.name});
  
  factory User.fromJson(dynamic json) => User(
    id: json['id'] as String,
    name: json['name'] as String,
  );
  
  Map<String, dynamic> toJson() => {'id': id, 'name': name};
}

void main() {
  // æ¨¡æ‹Ÿ API å“åº”
  var responseJson = '''
  {
    "success": true,
    "data": {"id": "123", "name": "Alice"},
    "statusCode": 200
  }
  ''';
  
  var decoded = jsonDecode(responseJson) as Map<String, dynamic>;
  var response = ApiResponse<User>.fromJson(
    decoded,
    (data) => User.fromJson(data),
  );
  
  print('Success: ${response.success}');
  print('User: ${response.data?.name}');
  
  // ç¼–ç å› JSON
  var encoder = JsonEncoder.withIndent('  ');
  print(encoder.convert(response.toJson((u) => u.toJson())));
}
```

### 7.4 äºŒè¿›åˆ¶æ•°æ®çš„åºåˆ—åŒ–

```dart
import 'dart:convert';
import 'dart:typed_data';

class BinarySerializer {
  // å°†äºŒè¿›åˆ¶æ•°æ®ç¼–ç ä¸º Base64 å­—ç¬¦ä¸²
  static String encode(Uint8List data) {
    return base64.encode(data);
  }
  
  // å°† Base64 å­—ç¬¦ä¸²è§£ç ä¸ºäºŒè¿›åˆ¶æ•°æ®
  static Uint8List decode(String base64String) {
    return Uint8List.fromList(base64.decode(base64String));
  }
  
  // åˆ›å»ºåŒ…å«äºŒè¿›åˆ¶æ•°æ®çš„ JSON
  static String createBinaryJson(String name, Uint8List data) {
    var jsonData = {
      'name': name,
      'data': encode(data),
      'size': data.length,
      'encoding': 'base64',
    };
    return jsonEncode(jsonData);
  }
  
  // ä» JSON æå–äºŒè¿›åˆ¶æ•°æ®
  static ({String name, Uint8List data}) extractBinaryJson(String jsonString) {
    var decoded = jsonDecode(jsonString) as Map<String, dynamic>;
    return (
      name: decoded['name'] as String,
      data: decode(decoded['data'] as String),
    );
  }
}

void main() {
  // æ¨¡æ‹ŸäºŒè¿›åˆ¶æ•°æ®
  var binaryData = Uint8List.fromList([0x89, 0x50, 0x4E, 0x47]);  // PNG æ–‡ä»¶å¤´
  
  // åºåˆ—åŒ–
  var json = BinarySerializer.createBinaryJson('image.png', binaryData);
  print(json);
  
  // ååºåˆ—åŒ–
  var extracted = BinarySerializer.extractBinaryJson(json);
  print('Name: ${extracted.name}');
  print('Data: ${extracted.data}');
}
```

## é™„å½•ï¼šdart:convert æ ¸å¿ƒç±»é€ŸæŸ¥è¡¨

| ç±»/å‡½æ•° | ä¸»è¦ç”¨é€” | æ ¸å¿ƒæ–¹æ³• |
|---------|---------|---------|
| jsonDecode | JSON å­—ç¬¦ä¸²è§£ç  | jsonDecode(string, {reviver}) |
| jsonEncode | JSON å­—ç¬¦ä¸²ç¼–ç  | jsonEncode(object, {toEncodable}) |
| JsonEncoder | JSON ç¼–ç å™¨ | convert(), JsonEncoder.withIndent() |
| JsonDecoder | JSON è§£ç å™¨ | convert(), JsonDecoder({reviver}) |
| JsonCodec | JSON ç¼–è§£ç å™¨ | encode(), decode() |
| utf8 | UTF-8 ç¼–è§£ç å™¨ | encode(), decode(), encoder, decoder |
| latin1 | Latin-1 ç¼–è§£ç å™¨ | encode(), decode(), encoder, decoder |
| ascii | ASCII ç¼–è§£ç å™¨ | encode(), decode(), encoder, decoder |
| base64 | Base64 ç¼–è§£ç å™¨ | encode(), decode(), encoder, decoder |
| base64Url | URL å®‰å…¨ Base64 | encode(), decode(), encoder, decoder |
| LineSplitter | è¡Œåˆ†å‰²å™¨ | convert(), bind(), split() |
| HtmlEscape | HTML è½¬ä¹‰ | convert(), HtmlEscapeMode |
| Codec | ç¼–è§£ç å™¨åŸºç±» | encode(), decode(), encoder, decoder |
| Converter | è½¬æ¢å™¨åŸºç±» | convert(), startChunkedConversion() |
| ChunkedConversionSink | æµå¼è½¬æ¢ Sink | add(), close() |

---

æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»äº† Dart æ ¸å¿ƒåº“ `dart:convert` çš„å„ç±»åŠŸèƒ½ï¼ŒåŒ…æ‹¬ JSON ç¼–è§£ç ã€å­—ç¬¦ç¼–ç ã€Base64 ç¼–ç ã€è¡Œåˆ†å‰²å™¨ä»¥åŠç¼–è§£ç å™¨æ¡†æ¶ã€‚æŒæ¡è¿™äº›å†…å®¹å°†å¸®åŠ©å¼€å‘è€…åœ¨ Dart å’Œ Flutter å¼€å‘ä¸­é«˜æ•ˆåœ°å¤„ç†æ•°æ®è½¬æ¢å’Œåºåˆ—åŒ–ä»»åŠ¡ã€‚
