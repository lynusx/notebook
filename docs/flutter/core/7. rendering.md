# rendering -- 渲染树与布局系统

实现 Flutter 的三棵树之一（Render Tree），负责布局（Layout）、绘制（Paint）、命中测试（Hit Test）和语义生成（Semantics）。

### 1.1 核心能力

- 渲染对象（RenderObject、RenderBox、RenderSliver）
- 布局协议（BoxConstraints、SliverConstraints、LayoutCallback）
- 绘制边界（RepaintBoundary、Layer、OffsetLayer、PictureLayer）
- 语义集成（SemanticsNode、SemanticsConfiguration、RenderSemanticsGestureHandler）
- 特定渲染对象（RenderParagraph、RenderImage、RenderDecoratedBox、RenderStack、RenderFlex 等）
- 视口与滚动（RenderViewport、RenderSliverList、RenderSliverGrid）

### 1.2 库结构

```dart
flutter/rendering
│
├── 渲染对象基类
│   ├── RenderObject                    # 渲染对象基类
│   ├── RenderObjectWithChildMixin<T>   # 单子混入
│   ├── ContainerRenderObjectMixin<T, ParentData>  # 容器混入
│   ├── RenderAbstractViewport          # 抽象视口
│   ├── PipelineOwner                   # 管线所有者
│   ├── Constraints                     # 约束基类
│   ├── ParentData                      # 父数据基类
│   ├── PaintingContext                 # 绘制上下文
│   ├── RelayoutWhenSystemFontsChangeMixin  # 系统字体变化重布局混入
│   ├── DiagnosticsDebugCreator         # 诊断调试创建器
│   ├── RenderObjectElement             # 渲染对象元素 (来自 widgets)
│   └── FlutterErrorDetailsForRendering # 渲染错误详情
│
├── 盒子布局协议
│   ├── RenderBox                       # 盒子渲染对象基类
│   ├── BoxConstraints                  # 盒子约束
│   ├── BoxHitTestResult                # 盒子命中测试
│   ├── BoxHitTestEntry                 # 盒子命中条目
│   ├── BoxParentData                   # 盒子父数据 (offset)
│   ├── RenderProxyBox                  # 代理盒子
│   ├── RenderProxyBoxMixin             # 代理盒子混入
│   ├── RenderConstrainedBox            # 约束盒子
│   ├── RenderLimitedBox                # 限制盒子
│   ├── RenderAspectRatio               # 宽高比盒子
│   ├── RenderIntrinsicWidth            # 固有宽度
│   ├── RenderIntrinsicHeight           # 固有高度
│   ├── RenderOpacity                   # 不透明度
│   ├── RenderAnimatedOpacity           # 动画不透明度
│   ├── RenderClipRect                  # 矩形裁剪
│   ├── RenderClipRRect                 # 圆角矩形裁剪
│   ├── RenderClipOval                  # 椭圆形裁剪
│   ├── RenderClipPath                  # 路径裁剪
│   ├── RenderBackdropFilter            # 背景滤镜
│   ├── RenderDecoratedBox              # 装饰盒子
│   ├── RenderImage                     # 图像渲染
│   ├── RenderParagraph                 # 段落渲染
│   ├── RenderStack                     # 堆叠布局
│   ├── RenderIndexedStack              # 索引堆叠
│   ├── RenderPositionedBox             # 定位盒子 (Align/Center)
│   ├── RenderFractionallySizedBox      # 分数尺寸盒子
│   ├── RenderTransform                 # 变换
│   ├── RenderRotatedBox                # 旋转盒子
│   ├── RenderOffstage                  # 离屏舞台
│   ├── RenderSizedOverflowBox          # 尺寸溢出盒子
│   ├── RenderOverflowBox               # 溢出盒子
│   ├── RenderConstrainedOverflowBox    # 约束溢出盒子
│   ├── RenderCustomSingleChildLayout   # 自定义单孩子布局
│   └── RenderLayoutBuilder             # 布局构建器
│
├── 弹性与浮动布局
│   ├── RenderFlex                      # 弹性布局基类
│   ├── RenderRow                       # 行布局 (Flex horizontal)
│   ├── RenderColumn                    # 列布局 (Flex vertical)
│   ├── MainAxisAlignment               # 主轴对齐枚举
│   ├── CrossAxisAlignment              # 交叉轴对齐枚举
│   ├── MainAxisSize                    # 主轴尺寸枚举
│   ├── RenderWrap                      # 流式布局
│   ├── WrapAlignment                   # 流式对齐枚举
│   ├── WrapCrossAlignment              # 流式交叉对齐枚举
│   ├── RenderFlow                      # 自定义流布局
│   └── FlowDelegate                    # 流委托基类
│
├── Sliver 列表与视口
│   ├── RenderSliver                    # Sliver 渲染对象基类
│   ├── SliverConstraints               # Sliver 约束
│   ├── SliverGeometry                  # Sliver 几何信息
│   ├── SliverHitTestResult             # Sliver 命中测试
│   ├── SliverHitTestEntry              # Sliver 命中条目
│   ├── RenderViewport                  # 视口
│   ├── RenderViewportBase              # 视口基类
│   ├── RenderShrinkWrappingViewport    # 收缩包裹视口
│   ├── RenderSliverList                # Sliver 列表
│   ├── RenderSliverFixedExtentList     # 固定高度 Sliver 列表
│   ├── RenderSliverGrid                # Sliver 网格
│   ├── SliverGridDelegate              # 网格委托基类
│   ├── SliverGridLayout                # 网格布局
│   ├── SliverGridGeometry              # 网格几何
│   ├── SliverGridRegularTileLayout     # 规则网格布局
│   ├── SliverGridDelegateWithFixedCrossAxisCount  # 固定列数
│   ├── SliverGridDelegateWithMaxCrossAxisExtent   # 最大列宽
│   ├── RenderSliverToBoxAdapter        # Sliver 转 Box 适配器
│   ├── RenderSliverFillViewport        # 填充视口 Sliver
│   ├── RenderSliverFillRemaining       # 填充剩余空间
│   ├── RenderSliverFixedExtentBoxAdaptor  # 固定高度适配器
│   ├── RenderSliverOffstage            # Sliver 离屏
│   ├── RenderSliverOpacity             # Sliver 不透明度
│   ├── RenderSliverAnimatedOpacity     # Sliver 动画不透明度
│   ├── RenderSliverPadding             # Sliver 内边距
│   ├── RenderSliverIgnorePointer       # Sliver 忽略指针
│   ├── SliverLogicalParentData         # Sliver 逻辑父数据
│   └── SliverPhysicalParentData        # Sliver 物理父数据
│
├── 滚动相关
│   ├── RenderScrollable                # 可滚动渲染对象
│   ├── ViewportOffset                  # 视口偏移基类
│   ├── ScrollDirection                 # 滚动方向枚举
│   ├── GrowthDirection                 # 增长方向枚举
│   ├── ScrollActivity                  # 滚动活动基类
│   ├── ScrollActivityDelegate          # 滚动活动委托
│   ├── ScrollDragController            # 滚动拖拽控制器
│   ├── BallisticScrollActivity         # 弹道滚动活动
│   ├── DrivenScrollActivity            # 驱动滚动活动
│   ├── IdleScrollActivity              # 空闲滚动活动
│   └── ScrollHoldController            # 滚动保持控制器
│
├── 层与合成
│   ├── Layer                           # 层基类
│   ├── ContainerLayer                  # 容器层
│   ├── OffsetLayer                     # 偏移层
│   ├── TransformLayer                  # 变换层
│   ├── ClipRectLayer                   # 矩形裁剪层
│   ├── ClipRRectLayer                  # 圆角矩形裁剪层
│   ├── ClipPathLayer                   # 路径裁剪层
│   ├── OpacityLayer                    # 不透明度层
│   ├── ShaderMaskLayer                 # 着色器遮罩层
│   ├── BackdropFilterLayer             # 背景滤镜层
│   ├── PictureLayer                    # 图画层
│   ├── TextureLayer                    # 纹理层
│   ├── PlatformViewLayer               # 平台视图层
│   ├── LeaderLayer                     # 领导者层
│   ├── FollowerLayer                   # 跟随者层
│   ├── LayerLink                       # 层链接
│   ├── LayerHandle<T extends Layer>    # 层句柄
│   └── AnnotatedRegionLayer<T>         # 注解区域层
│
├── 绘制边界与重绘
│   ├── RepaintBoundary                 # 重绘边界 (Widget)
│   ├── RenderRepaintBoundary           # 重绘边界渲染对象
│   ├── isRepaintBoundary               # 是否重绘边界标记
│   └── debugRepaintRainbowEnabled      # 彩虹重绘调试标志
│
├── 命中测试与事件处理
│   ├── hitTest()                       # 命中测试方法
│   ├── hitTestSelf()                   # 自命中测试
│   ├── hitTestChildren()               # 子命中测试
│   ├── defaultHitTestChildren()        # 默认子命中测试
│   ├── defaultPaint()                  # 默认绘制
│   ├── applyPaintTransform()           # 应用绘制变换
│   ├── globalToLocal()                 # 全局到本地坐标转换
│   └── localToGlobal()                 # 本地到全局坐标转换
│
├── 语义与无障碍
│   ├── RenderSemanticsAnnotations      # 语义注解
│   ├── RenderSemanticsGestureHandler   # 语义手势处理器
│   ├── RenderMergeSemantics            # 合并语义
│   ├── RenderBlockSemantics            # 阻塞语义
│   ├── RenderExcludeSemantics          # 排除语义
│   ├── RenderIndexedSemantics          # 索引语义
│   └── SemanticsNode                   # 语义节点 (来自 semantics)
│
├── 性能与调试
│   ├── debugPaintSizeEnabled           # 调试绘制尺寸
│   ├── debugPaintBaselinesEnabled      # 调试绘制基线
│   ├── debugPaintLayerBordersEnabled   # 调试层边界
│   ├── debugPaintPointersEnabled       # 调试指针
│   ├── debugRepaintTextRainbowEnabled  # 调试文本重绘
│   ├── RenderPerformanceOverlay        # 性能覆盖层渲染对象
│   ├── PerformanceOverlayLayer         # 性能覆盖层
│   └── debugDumpRenderTree()           # 转储渲染树
│
├── 表格布局
│   ├── RenderTable                     # 表格渲染
│   ├── TableCellParentData             # 单元格父数据
│   ├── TableBorder                     # 表格边框
│   └── TableColumnWidth                # 表格列宽基类
│       ├── IntrinsicColumnWidth        # 固有宽度
│       ├── FixedColumnWidth            # 固定宽度
│       ├── FractionColumnWidth         # 分数宽度
│       ├── FlexColumnWidth             # 弹性宽度
│       └── MaxColumnWidth              # 最大宽度
│
└── 其他渲染对象
    ├── RenderCustomPaint               # 自定义绘制
    ├── CustomPainter                   # 自定义绘制器接口
    ├── RenderBuilder                   # 构建器渲染
    ├── RenderErrorBox                  # 错误盒子
    ├── RenderFollowerLayer             # 跟随层渲染
    ├── RenderLeaderLayer               # 领导层渲染
    ├── RenderAbsorbPointer             # 吸收指针
    ├── RenderIgnorePointer             # 忽略指针
    ├── RenderMouseRegion               # 鼠标区域
    ├── RenderPointerListener           # 指针监听器
    ├── RenderVisibility                # 可见性
    ├── RenderSliverVisibility          # Sliver 可见性
    └── RenderTapRegion                 # 点击区域
```

