# widgets -- Widgets框架核心

Flutter 最核心库之一，实现组件（Widget）、元素（Element）和状态（State）系统，提供基础 Widget 集合（Container、Row、Column、Stack、Text、Image 等）以及高级功能（InheritedWidget、Notification、Focus、Overlay、Navigator 等）。

### 1.1 核心能力

- 三棵树系统（Widget、Element、RenderObject）
- 状态管理（StatefulWidget、StatelessWidget、State、setState）
- 依赖注入（InheritedWidget、InheritedModel、InheritedNotifier、BuildContext.dependOnInheritedWidgetOfExactType）
- 布局 Widget（Container、Row、Column、Stack、Wrap、Flex、Expanded、Flexible 等）
- 绘制与效果（Opacity、ClipOval、BackdropFilter、ShaderMask、ColorFiltered 等）
- 文本与图像（Text、RichText、Image、RawImage、Icon）
- 输入与表单（EditableText、TextField、Form、FormField、FocusNode、TextEditingController）
- 导航与路由（Navigator、Route、PageRoute、ModalRoute、Overlay、RouteSettings）
- 通知与滚动（NotificationListener、Scrollable、ScrollController、ListView、GridView、PageView、CustomScrollView）
- 动画与过渡（AnimatedContainer、AnimatedBuilder、Hero、FadeTransition、SlideTransition、RotationTransition）
- 手势处理（GestureDetector、InkWell、Listener、AbsorbPointer、IgnorePointer）
- 上下文菜单（ContextMenuController、ContextMenuItem）
- 焦点管理（FocusNode、FocusScope、FocusTraversalGroup）
- 平台适配（PlatformViewLink、AndroidView、UiKitView）
- 异步数据（FutureBuilder、StreamBuilder、ValueListenableBuilder）
- 布局约束与测量（LayoutBuilder、FractionallySizedBox、AspectRatio、FittedBox）

### 1.2 库结构

```dart
flutter/widgets
│
├── 基础 Widget 类型
│   ├── Widget                    # Widget 基类
│   ├── StatelessWidget           # 无状态 Widget
│   ├── StatefulWidget            # 有状态 Widget
│   ├── State<T>                  # 状态基类
│   ├── Element                   # Element 基类
│   ├── ComponentElement          # 组件 Element
│   ├── StatelessElement          # 无状态 Element
│   ├── StatefulElement           # 有状态 Element
│   ├── ProxyWidget               # 代理 Widget
│   ├── ParentDataWidget<T>       # 父数据 Widget
│   ├── InheritedWidget           # 继承式 Widget
│   ├── RenderObjectWidget        # 渲染对象 Widget
│   ├── RenderObjectElement       # 渲染对象 Element
│   ├── SingleChildRenderObjectWidget   # 单子渲染 Widget
│   ├── MultiChildRenderObjectWidget    # 多子渲染 Widget
│   ├── LeafRenderObjectWidget    # 叶子渲染 Widget
│   └── BuildContext              # 构建上下文接口
│
├── 依赖注入与继承
│   ├── InheritedWidget           # 基础继承 Widget
│   ├── InheritedModel<T>         # 模型继承
│   ├── InheritedNotifier<T>      # 通知器继承
│   ├── InheritedTheme            # 主题继承
│   ├── BuildContext.dependOnInheritedWidgetOfExactType()  # 依赖获取
│   ├── BuildContext.getElementForInheritedWidgetOfExactType()  # 获取 Element
│   ├── BuildContext.findAncestorWidgetOfExactType()  # 查找祖先
│   ├── Aspect                    # InheritedModel 的 Aspect
│   └── Notification              # 通知基类
│
├── 单子布局
│   ├── Container                 # 容器
│   ├── Padding                   # 内边距
│   ├── Align                     # 对齐
│   ├── Center                    # 居中
│   ├── FractionallySizedBox      # 分数尺寸
│   ├── AspectRatio               # 宽高比
│   ├── FittedBox                 # 适应盒
│   ├── LimitedBox                # 限制盒
│   ├── OverflowBox               # 溢出盒
│   ├── SizedBox                  # 固定尺寸
│   ├── SizedOverflowBox          # 尺寸溢出盒
│   ├── ConstrainedBox            # 约束盒
│   ├── UnconstrainedBox          # 无约束盒
│   ├── FractionalTranslation     # 分数位移
│   ├── Transform                 # 变换
│   ├── RotatedBox                # 旋转盒
│   ├── DecoratedBox              # 装饰盒
│   ├── Opacity                   # 不透明度
│   ├── AnimatedOpacity           # 动画不透明度
│   ├── ClipRect                  # 矩形裁剪
│   ├── ClipRRect                 # 圆角矩形裁剪
│   ├── ClipOval                  # 椭圆形裁剪
│   ├── ClipPath                  # 路径裁剪
│   ├── ClipBehavior              # 裁剪行为枚举
│   ├── BackdropFilter            # 背景滤镜
│   ├── ShaderMask                # 着色器遮罩
│   ├── ColorFiltered             # 颜色滤镜
│   ├── LayoutBuilder             # 布局构建器
│   ├── Builder                   # 构建器
│   ├── StatefulBuilder           # 有状态构建器
│   ├── ColoredBox                # 颜色盒
│   ├── ConstraintsTransformBox   # 约束变换盒
│   ├── Baseline                  # 基线对齐
│   ├── Offstage                  # 离屏
│   └── WidgetsApp                # Widgets 应用
│
├── 多子布局
│   ├── Row                       # 行
│   ├── Column                    # 列
│   ├── Flex                      # 弹性布局基类
│   ├── Expanded                  # 扩展
│   ├── Flexible                  # 灵活
│   ├── Spacer                    # 间隔
│   ├── Stack                     # 堆叠
│   ├── Positioned                # 定位
│   ├── PositionedDirectional     # 方向性定位
│   ├── Align                     # 对齐
│   ├── Wrap                      # 流式布局
│   ├── Flow                      # 自定义流布局
│   ├── FlowDelegate              # 流委托
│   ├── Table                     # 表格
│   ├── TableRow                  # 表格行
│   ├── IndexedStack              # 索引堆叠
│   ├── LayoutId                  # 布局 ID
│   ├── MultiChildLayoutDelegate  # 多子布局委托
│   ├── CustomMultiChildLayout    # 自定义多子布局
│   ├── ListBody                  # 列表体
│   ├── OverflowBox               # 溢出盒 (多子版本)
│   └── StackFit                  # 堆叠适应枚举
│
├── 滚动与列表
│   ├── Scrollable                # 可滚动基类
│   ├── ScrollController          # 滚动控制器
│   ├── ScrollPosition            # 滚动位置
│   ├── ScrollPhysics             # 滚动物理
│   ├── ClampingScrollPhysics     # 钳制物理
│   ├── BouncingScrollPhysics     # 回弹物理
│   ├── AlwaysScrollableScrollPhysics   # 始终可滚动
│   ├── NeverScrollableScrollPhysics    # 不可滚动
│   ├── ListView                  # 列表视图
│   ├── GridView                  # 网格视图
│   ├── PageView                  # 页面视图
│   ├── PageController            # 页面控制器
│   ├── CustomScrollView          # 自定义滚动视图
│   ├── SingleChildScrollView     # 单子滚动视图
│   ├── Scrollbar                 # 滚动条
│   ├── NotificationListener<T>   # 通知监听
│   ├── ScrollMetrics             # 滚动度量
│   ├── ScrollNotification        # 滚动通知基类
│   ├── ScrollStartNotification   # 滚动开始通知
│   ├── ScrollUpdateNotification  # 滚动更新通知
│   ├── ScrollEndNotification     # 滚动结束通知
│   ├── OverscrollNotification    # 过滚动通知
│   ├── UserScrollNotification    # 用户滚动通知
│   ├── DraggableScrollableSheet  # 可拖拽滚动表单
│   ├── DraggableScrollableController   # 可拖拽滚动控制器
│   └── TwoDimensionalScrollable  # 二维可滚动 (Flutter 3.13+)
│
├── Sliver 系统
│   ├── SliverList                # Sliver 列表
│   ├── SliverGrid                # Sliver 网格
│   ├── SliverToBoxAdapter        # Sliver 转 Box
│   ├── SliverPadding             # Sliver 内边距
│   ├── SliverFillViewport        # 填充视口
│   ├── SliverFillRemaining       # 填充剩余
│   ├── SliverFixedExtentList     # 固定高度列表
│   ├── SliverPrototypeExtentList # 原型高度列表
│   ├── SliverOpacity             # Sliver 不透明度
│   ├── SliverVisibility          # Sliver 可见性
│   ├── SliverAnimatedOpacity     # Sliver 动画不透明度
│   ├── SliverPersistentHeader    # 持久头部
│   ├── SliverOverlapAbsorber     # 重叠吸收器
│   ├── SliverOverlapInjector     # 重叠注入器
│   ├── SliverIgnorePointer       # Sliver 忽略指针
│   ├── SliverReorderableList     # 可重排序列表
│   ├── SliverVariedExtentList    # 可变高度列表 (Flutter 3.13+)
│   └── SliverMainAxisGroup       # Sliver 主轴组 (Flutter 3.16+)
│
├── 文本与图像
│   ├── Text                      # 文本 Widget
│   ├── RichText                  # 富文本
│   ├── DefaultTextStyle          # 默认文本样式
│   ├── DefaultTextHeightBehavior # 默认文本高度行为
│   ├── TextStyle                 # 文本样式 (来自 painting)
│   ├── TextSpan                  # 文本片段
│   ├── WidgetSpan                # Widget 片段
│   ├── Image                     # 图像 Widget
│   ├── RawImage                  # 原始图像
│   ├── ImageIcon                 # 图像图标
│   ├── FadeInImage               # 渐显图像
│   ├── DecorationImage           # 装饰图像
│   ├── ImageFiltered             # 图像滤镜
│   ├── IconTheme                 # 图标主题
│   ├── IconThemeData             # 图标主题数据
│   ├── SelectableText            # 可选文本 (基础)
│   ├── SelectionContainer        # 选择容器
│   └── SelectionRegistrar        # 选择注册器
│
├── 输入与表单
│   ├── EditableText              # 可编辑文本
│   ├── TextEditingController     # 文本编辑控制器
│   ├── TextSelectionControls     # 文本选择控制
│   ├── TextSelectionOverlay      # 文本选择覆盖层
│   ├── FocusNode                 # 焦点节点
│   ├── FocusScope                # 焦点范围
│   ├── FocusScopeNode            # 焦点范围节点
│   ├── FocusTraversalGroup       # 焦点遍历组
│   ├── FocusTraversalPolicy      # 焦点遍历策略
│   ├── WidgetOrderTraversalPolicy    # Widget 顺序遍历
│   ├── ReadingOrderTraversalPolicy   # 阅读顺序遍历
│   ├── NumericFocusOrder         # 数字焦点顺序
│   ├── LexicalFocusOrder         # 字典焦点顺序
│   ├── FocusOrder                # 焦点顺序基类
│   ├── Form                      # 表单
│   ├── FormState                 # 表单状态
│   ├── FormField<T>              # 表单字段
│   ├── AutofillGroup             # 自动填充组
│   ├── AutofillContextAction     # 自动填充上下文动作
│   ├── RawKeyboardListener       # 原始键盘监听
│   ├── Shortcuts                 # 快捷键
│   ├── Actions                   # 动作
│   ├── Intent                    # 意图
│   ├── ActionDispatcher          # 动作分发器
│   ├── CallbackShortcuts         # 回调快捷键
│   └── UndoHistoryController     # 撤销历史控制器
│
├── 手势处理
│   ├── GestureDetector           # 手势检测器
│   ├── GestureRecognizerFactory  # 识别器工厂
│   ├── GestureRecognizerFactoryWithHandlers  # 带处理器工厂
│   ├── Listener                  # 原始指针监听
│   ├── AbsorbPointer             # 吸收指针
│   ├── IgnorePointer             # 忽略指针
│   ├── ScrollConfiguration       # 滚动配置
│   ├── RawGestureDetector        # 原始手势检测器
│   ├── InteractiveViewer         # 交互查看器 (缩放/平移)
│   ├── TransformationController    # 变换控制器
│   └── GestureArenaTeam          # 手势竞技场团队
│
├── 动画与过渡
│   ├── AnimatedWidget            # 动画 Widget 基类
│   ├── AnimatedBuilder           # 动画构建器
│   ├── AnimatedContainer         # 动画容器
│   ├── AnimatedOpacity           # 动画不透明度
│   ├── AnimatedPadding           # 动画内边距
│   ├── AnimatedAlign             # 动画对齐
│   ├── AnimatedPositioned        # 动画定位
│   ├── AnimatedPositionedDirectional   # 动画方向性定位
│   ├── AnimatedSize              # 动画尺寸
│   ├── AnimatedCrossFade         # 交叉淡入淡出
│   ├── AnimatedSwitcher          # 动画切换器
│   ├── AnimatedList              # 动画列表
│   ├── AnimatedListState         # 动画列表状态
│   ├── SliverAnimatedList        # Sliver 动画列表
│   ├── Hero                      # 英雄动画
│   ├── HeroController            # 英雄控制器
│   ├── HeroControllerScope       # 英雄控制器范围
│   ├── FadeTransition            # 淡入淡出过渡
│   ├── SlideTransition           # 滑动过渡
│   ├── ScaleTransition           # 缩放过渡
│   ├── RotationTransition        # 旋转过渡
│   ├── SizeTransition            # 尺寸过渡
│   ├── DecoratedBoxTransition    # 装饰盒过渡
│   ├── AlignTransition           # 对齐过渡
│   ├── PositionedTransition      # 定位过渡
│   ├── RelativePositionedTransition  # 相对定位过渡
│   ├── DefaultTextStyleTransition    # 默认文本样式过渡
│   ├── MatrixTransition          # 矩阵过渡
│   ├── AnimatedTheme             # 动画主题
│   ├── AnimatedModalBarrier      # 动画模态屏障
│   ├── TweenAnimationBuilder     # 补间动画构建器
│   └── PageTransitionsTheme      # 页面过渡主题
│
├── 导航与路由
│   ├── Navigator                 # 导航器
│   ├── NavigatorObserver         # 导航器观察者
│   ├── RouteObserver<T>          # 路由观察者
│   ├── RouteAware                # 路由感知接口
│   ├── Route                     # 路由基类
│   ├── PageRoute                 # 页面路由
│   ├── ModalRoute                # 模态路由
│   ├── PopupRoute                # 弹出路由
│   ├── DialogRoute               # 对话框路由
│   ├── RawDialogRoute            # 原始对话框路由
│   ├── RouteSettings             # 路由设置
│   ├── RoutePredicate            # 路由断言
│   ├── RouteFactory              # 路由工厂
│   ├── Page                      # 页面对象
│   ├── Router                    # 路由器
│   ├── RouteInformationParser    # 路由信息解析器
│   ├── RouterDelegate            # 路由器委托
│   ├── RouteInformationProvider  # 路由信息提供者
│   ├── BackButtonDispatcher      # 返回按钮分发器
│   ├── ChildBackButtonDispatcher # 子返回按钮分发器
│   ├── RootBackButtonDispatcher  # 根返回按钮分发器
│   ├── PlatformRouteInformationProvider  # 平台路由信息提供者
│   ├── Overlay                   # 覆盖层
│   ├── OverlayEntry              # 覆盖层条目
│   ├── OverlayPortal             # 覆盖层门户
│   ├── OverlayPortalController   # 覆盖层门户控制器
│   ├── OverlayState              # 覆盖层状态
│   ├── RootOverlay               # 根覆盖层
│   ├── WidgetsApp                # Widgets 应用
│   ├── WidgetsApp.router         # 路由器构造
│   └── NavigationToolbar         # 导航工具栏
│
├── 异步与状态管理
│   ├── FutureBuilder<T>          # Future 构建器
│   ├── StreamBuilder<T>          # Stream 构建器
│   ├── ValueListenableBuilder<T> # 值监听构建器
│   ├── ListenableBuilder         # 监听器构建器
│   ├── AsyncSnapshot<T>          # 异步快照
│   ├── ConnectionState           # 连接状态枚举
│   ├── InheritedStream           # 继承式 Stream
│   ├── StreamListener<T>         # Stream 监听
│   └── ValueNotifier<T>          # 值通知器 (来自 foundation)
│
├── 上下文菜单
│   ├── ContextMenuController       # 上下文菜单控制器
│   ├── ContextMenuItem             # 上下文菜单项
│   ├── ContextMenuButtonItem       # 按钮菜单项
│   ├── ContextMenuItemBuilder      # 菜单项构建器
│   ├── AdaptiveTextSelectionToolbar  # 自适应文本选择工具栏
│   ├── TextSelectionToolbar        # 文本选择工具栏
│   ├── TextSelectionToolbarItem    # 工具栏项
│   ├── TextSelectionToolbarItemBuilder   # 工具栏项构建器
│   ├── UndoHistoryController       # 撤销历史控制器
│   ├── UndoHistoryValue            # 撤销历史值
│   ├── TextEditingController       # 文本编辑控制器
│   ├── ToolbarOptions              # 工具栏选项
│   └── TextSelectionControls       # 文本选择控制
│
├── 平台视图
│   ├── PlatformViewLink            # 平台视图链接
│   ├── PlatformViewSurface         # 平台视图表面
│   ├── AndroidView                 # Android 视图
│   ├── AndroidViewSurface          # Android 表面
│   ├── UiKitView                   # iOS 视图
│   ├── HtmlElementView             # Web HTML 元素视图
│   ├── PlatformViewCreationParams  # 创建参数
│   ├── PlatformViewController      # 平台视图控制器
│   └── TextureBox                  # 纹理盒
│
├── 语义与无障碍
│   ├── Semantics                   # 语义
│   ├── SemanticsDebugger           # 语义调试器
│   ├── MergeSemantics              # 合并语义
│   ├── ExcludeSemantics            # 排除语义
│   ├── BlockSemantics              # 阻塞语义
│   ├── IndexedSemantics            # 索引语义
│   ├── SemanticsProperties         # 语义属性
│   ├── SemanticsSortKey            # 语义排序键
│   ├── OrdinalSortKey              # 顺序排序键
│   ├── CustomSemanticsAction       # 自定义语义动作
│   ├── SemanticsService            # 语义服务
│   └── AccessibilityFeatures       # 无障碍特性
│
├── 调试与性能
│   ├── PerformanceOverlay          # 性能覆盖层
│   ├── RepaintBoundary             # 重绘边界
│   ├── WidgetInspector             # Widget 检查器
│   ├── InspectorSelection          # 检查器选择
│   ├── InspectorSerializationDelegate  # 检查器序列化委托
│   ├── DebugPaintSize              # 调试绘制尺寸
│   ├── DebugPaintBaselines         # 调试绘制基线
│   ├── DebugPaintLayerBorders      # 调试层边界
│   ├── DebugPaintPointers          # 调试指针
│   ├── WidgetsApp.showPerformanceOverlay   # 显示性能覆盖层
│   └── WidgetsApp.debugShowWidgetInspector # 显示检查器
│
└── 其他功能 Widget
    ├── Visibility                  # 可见性
    ├── Visibility.maintain         # 保持状态可见性
    ├── Opacity                     # 不透明度 (已在单子布局)
    ├── Offstage                    # 离屏 (已在单子布局)
    ├── DefaultAssetBundle          # 默认资源包
    ├── Localizations               # 本地化
    ├── Locale                      # 区域设置
    ├── MediaQuery                  # 媒体查询
    ├── MediaQueryData              # 媒体查询数据
    ├── OrientationBuilder          # 方向构建器
    ├── Orientation                 # 方向枚举
    ├── SafeArea                    # 安全区域
    ├── SliverSafeArea              # Sliver 安全区域
    ├── Title                       # 标题
    ├── CheckedModeBanner           # 检查模式横幅
    ├── Directionality              # 方向性
    ├── TextDirection               # 文本方向枚举
    ├── PhysicalModel               # 物理模型
    ├── PhysicalShape               # 物理形状
    ├── LimitedBox                  # 限制盒 (已在单子布局)
    ├── FractionalTranslation       # 分数位移 (已在单子布局)
    ├── SizeChangedLayoutNotifier   # 尺寸变化通知器
    ├── LayoutChangedNotification   # 布局变化通知
    ├── PreferredSize               # 首选尺寸
    ├── PreferredSizeWidget         # 首选尺寸 Widget
    ├── PrimaryScrollController     # 主滚动控制器
    ├── RestorationScope            # 恢复范围
    ├── RootRestorationScope        # 根恢复范围
    ├── RestorationBucket           # 恢复桶
    ├── UnmanagedRestorationScope   # 非托管恢复范围
    ├── SharedAppData               # 共享应用数据
    ├── ValueKey<T>                 # 值键 (来自 foundation)
    ├── UniqueKey                   # 唯一键 (来自 foundation)
    └── GlobalKey<T>                # 全局键 (来自 foundation)
```



---

