# semantics -- 语义与无障碍

实现辅助功能（Accessibility）支持，将 UI 转换为屏幕阅读器可理解的语义树，支持 TalkBack（Android）和 VoiceOver（iOS）。

### 1.1 核心能力

- 语义节点（SemanticsNode、SemanticsOwner、SemanticsConfiguration）
- 语义属性（label、hint、value、hintOverrides、onTap、onScrollUp 等）
- 语义事件（SemanticsEvent、AnnounceSemanticsEvent、TooltipSemanticsEvent、ScrollCompletedSemanticsEvent）
- 无障碍手势（SemanticsAction：tap、longPress、scrollLeft、scrollRight、increase、decrease 等）
- 语义边界（Semantics、MergeSemantics、ExcludeSemantics、BlockSemantics、SemanticsDebugger）
- 自定义绘制语义（CustomPainterSemantics）

### 1.2 库结构

```dart
flutter/semantics
│
├── 语义节点与树
│   ├── SemanticsNode               # 语义节点
│   ├── SemanticsNode.rect()        # 矩形构造
│   ├── SemanticsOwner              # 语义树所有者
│   ├── SemanticsConfiguration      # 语义配置
│   ├── SemanticsData               # 语义数据快照
│   ├── SemanticsProperties         # 语义属性包装
│   ├── SemanticsHintOverrides      # 语义提示覆盖
│   ├── SemanticsGeometry           # 语义几何
│   ├── AttributedString            # 属性字符串
│   ├── AttributedStringProperty    # 属性字符串诊断属性
│   ├── StringAttribute             # 字符串属性基类
│   ├── SpellOutStringAttribute     # 拼读属性
│   ├── LocaleStringAttribute       # 区域属性
│   ├── CustomSemanticsAction       # 自定义语义动作
│   └── CustomSemanticsAction.getActionHandler()  # 获取处理器
│
├── 语义动作
│   ├── SemanticsAction             # 语义动作枚举
│   ├── SemanticsAction.tap         # 轻点
│   ├── SemanticsAction.longPress   # 长按
│   ├── SemanticsAction.scrollLeft  # 向左滚动
│   ├── SemanticsAction.scrollRight # 向右滚动
│   ├── SemanticsAction.scrollUp    # 向上滚动
│   ├── SemanticsAction.scrollDown  # 向下滚动
│   ├── SemanticsAction.increase    # 增加
│   ├── SemanticsAction.decrease    # 减少
│   ├── SemanticsAction.showOnScreen    # 显示在屏幕上
│   ├── SemanticsAction.moveCursorForwardByCharacter  # 光标前进(字符)
│   ├── SemanticsAction.moveCursorBackwardByCharacter # 光标后退(字符)
│   ├── SemanticsAction.moveCursorForwardByWord       # 光标前进(词)
│   ├── SemanticsAction.moveCursorBackwardByWord      # 光标后退(词)
│   ├── SemanticsAction.setSelection    # 设置选择
│   ├── SemanticsAction.copy            # 复制
│   ├── SemanticsAction.cut             # 剪切
│   ├── SemanticsAction.paste           # 粘贴
│   ├── SemanticsAction.didGainFocus    # 获得焦点
│   ├── SemanticsAction.didLoseFocus    # 失去焦点
│   ├── SemanticsAction.dismiss         # 清除
│   ├── SemanticsAction.setText         # 设置文本
│   ├── SemanticsAction.setValue        # 设置值
│   ├── SemanticsAction.fromIndex()     # 从索引创建
│   └── SemanticsAction.getIndex()      # 获取索引
│
├── 语义标志
│   ├── SemanticsFlag               # 语义标志枚举
│   ├── SemanticsFlag.hasEnabledState   # 有启用状态
│   ├── SemanticsFlag.isEnabled         # 已启用
│   ├── SemanticsFlag.hasCheckedState   # 有选中状态
│   ├── SemanticsFlag.isChecked         # 已选中
│   ├── SemanticsFlag.isUnchecked       # 未选中
│   ├── SemanticsFlag.hasToggledState   # 有切换状态
│   ├── SemanticsFlag.isToggled         # 已切换
│   ├── SemanticsFlag.isSelected        # 已选择
│   ├── SemanticsFlag.isTextField       # 文本字段
│   ├── SemanticsFlag.isFocused         # 已聚焦
│   ├── SemanticsFlag.hasImplicitScrolling  # 隐式滚动
│   ├── SemanticsFlag.isMultiline       # 多行
│   ├── SemanticsFlag.isObscured        # 模糊处理
│   ├── SemanticsFlag.scopesRoute       # 作用域路由
│   ├── SemanticsFlag.namesRoute        # 命名路由
│   ├── SemanticsFlag.isHidden          # 隐藏
│   ├── SemanticsFlag.isImage           # 图像
│   ├── SemanticsFlag.isLiveRegion      # 实时区域
│   ├── SemanticsFlag.isHeader          # 头部
│   ├── SemanticsFlag.isSlider          # 滑块
│   ├── SemanticsFlag.isKeyboardKey     # 键盘按键
│   ├── SemanticsFlag.isLink            # 链接
│   ├── SemanticsFlag.isCheckStateMixed     # 混合选中状态
│   ├── SemanticsFlag.isReadOnly            # 只读
│   ├── SemanticsFlag.isFocusable           # 可聚焦
│   ├── SemanticsFlag.isLink                # 链接
│   ├── SemanticsFlag.isTextField           # 文本字段
│   ├── SemanticsFlag.hasToggledState       # 有切换状态
│   ├── SemanticsFlag.isToggled             # 已切换
│   ├── SemanticsFlag.hasImplicitScrolling  # 隐式滚动
│   ├── SemanticsFlag.isMultiline           # 多行
│   ├── SemanticsFlag.isReadOnly            # 只读
│   ├── SemanticsFlag.isFocusable           # 可聚焦
│   ├── SemanticsFlag.isInMutuallyExclusiveGroup  # 互斥组
│   ├── SemanticsFlag.fromIndex()           # 从索引创建
│   └── SemanticsFlag.getIndex()            # 获取索引
│
├── 语义角色 [Flutter 3.3+]
│   ├── SemanticsRole               # 语义角色枚举
│   ├── SemanticsRole.none          # 无角色
│   ├── SemanticsRole.tab           # 标签
│   ├── SemanticsRole.tabBar        # 标签栏
│   ├── SemanticsRole.tabPanel      # 标签面板
│   ├── SemanticsRole.dialog        # 对话框
│   ├── SemanticsRole.alertDialog   # 警告对话框
│   ├── SemanticsRole.alert         # 警告
│   ├── SemanticsRole.tooltip       # 工具提示
│   ├── SemanticsRole.progressBar   # 进度条
│   ├── SemanticsRole.search        # 搜索
│   ├── SemanticsRole.searchBox     # 搜索框
│   ├── SemanticsRole.region        # 区域
│   ├── SemanticsRole.group         # 组
│   ├── SemanticsRole.button        # 按钮
│   ├── SemanticsRole.toggleButton  # 切换按钮
│   ├── SemanticsRole.menu          # 菜单
│   ├── SemanticsRole.menuBar       # 菜单栏
│   ├── SemanticsRole.menuItem      # 菜单项
│   ├── SemanticsRole.menuItemCheckBox  # 菜单项复选框
│   ├── SemanticsRole.menuItemRadio     # 菜单项单选
│   ├── SemanticsRole.comboBox      # 组合框
│   ├── SemanticsRole.list          # 列表
│   ├── SemanticsRole.listItem      # 列表项
│   ├── SemanticsRole.form          # 表单
│   ├── SemanticsRole.table         # 表格
│   ├── SemanticsRole.grid          # 网格
│   ├── SemanticsRole.cell          # 单元格
│   ├── SemanticsRole.row           # 行
│   ├── SemanticsRole.column        # 列
│   ├── SemanticsRole.heading       # 标题
│   ├── SemanticsRole.pageHeader    # 页面头部
│   ├── SemanticsRole.article       # 文章
│   ├── SemanticsRole.banner        # 横幅
│   ├── SemanticsRole.contentInfo   # 内容信息
│   ├── SemanticsRole.complementary # 补充
│   ├── SemanticsRole.document      # 文档
│   ├── SemanticsRole.main          # 主要内容
│   ├── SemanticsRole.navigation    # 导航
│   ├── SemanticsRole.search        # 搜索
│   └── SemanticsRole.application   # 应用
│
├── 语义事件
│   ├── SemanticsEvent              # 语义事件基类
│   ├── AnnounceSemanticsEvent      # 宣告事件
│   ├── TooltipSemanticsEvent       # 工具提示事件
│   ├── ScrollCompletedSemanticsEvent   # 滚动完成事件
│   ├── LiveRegionSemanticsEvent    # 实时区域事件
│   ├── UpdateLiveRegionEvent       # 更新实时区域
│   ├── SemanticsService            # 语义服务
│   ├── SemanticsService.announce() # 宣告
│   ├── SemanticsService.tooltip()  # 工具提示
│   └── SemanticsService.notify()   # 通知
│
├── 语义 Widget
│   ├── Semantics                   # 语义包装 Widget
│   ├── Semantics.fromProperties()  # 从属性构造
│   ├── MergeSemantics              # 合并语义
│   ├── ExcludeSemantics            # 排除语义
│   ├── BlockSemantics              # 阻塞语义
│   ├── IndexedSemantics            # 索引语义
│   ├── SemanticsDebugger           # 语义调试器
│   ├── SemanticsSortOrder          # 语义排序顺序
│   ├── SemanticsSortKey            # 语义排序键基类
│   ├── OrdinalSortKey              # 顺序排序键
│   ├── CustomPainterSemantics      # 自定义绘制语义
│   └── DebugSemanticsDumpOrder     # 调试语义转储顺序
│
├── 无障碍与工具
│   ├── AccessibilityFeatures       # 无障碍特性
│   ├── AccessibilityFeatures.onOffSwitchLabels  # 开关标签
│   ├── AccessibilityFeatures.invertColors       # 颜色反转
│   ├── AccessibilityFeatures.disableAnimations  # 禁用动画
│   ├── AccessibilityFeatures.boldText           # 粗体文本
│   ├── AccessibilityFeatures.reduceMotion       # 减少动效
│   ├── AccessibilityFeatures.highContrast       # 高对比度
│   ├── SemanticsHandle             # 语义句柄
│   ├── SemanticsUpdate             # 语义更新
│   ├── SemanticsUpdateBuilder      # 语义更新构建器
│   ├── SemanticsAnnotation         # 语义注解
│   ├── SemanticsTag                # 语义标签
│   └── SemanticsTag.from()         # 从值构造
│
└── 与 RenderObject 集成
    ├── RenderObject.describeSemanticsConfiguration()  # 描述配置
    ├── RenderObject.assembleSemanticsNode()           # 组装节点
    ├── RenderObject.clearSemantics()                  # 清除语义
    ├── RenderObject.markNeedsSemanticsUpdate()        # 标记需要更新
    ├── RenderObject.visitChildrenForSemantics()       # 访问子节点
    ├── RenderObject.debugDescribeChildren()           # 调试描述子节点
    └── PipelineOwner.flushSemantics()                 # 刷新语义
```

